<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISM Interactive Study Guide (All Domains)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- MASTER STYLESHEET --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        /* --- BASE & LAYOUT --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5EF; /* Warm Neutral Background */
            color: #333333;
        }
        .container {
            max-width: 1200px;
        }
        .section-header {
            border-left: 6px solid #00A896; /* Vibrant Teal Accent */
            padding-left: 1.25rem;
            font-size: 2.2rem;
            color: #222222;
        }

        /* --- NAVIGATION --- */
        .master-nav-item {
            transition: all 0.2s ease-in-out;
            text-align: left;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }
        .master-nav-item.active {
            background-color: #E0F7F5;
            border-left: 4px solid #00A896;
        }
        .master-nav-item.active .domain-title {
             color: #00796B;
        }
        .master-nav-item:not(.active):hover {
            background-color: #e2e8f0;
        }
        .domain-nav-item {
            transition: all 0.2s ease-in-out;
        }
        .domain-nav-item.active {
            border-bottom: 3px solid #00A896;
            font-weight: 700;
            color: #222222;
        }
        
        /* --- ACCORDIONS --- */
        .accordion-button {
            background-color: #EDEAE0;
            border-bottom: 1px solid #D5D2C8;
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: #333333;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
            cursor: pointer;
        }
        .accordion-button:hover {
            background-color: #D5D2C8;
            transform: translateY(-1px);
        }
        .accordion-content {
            background-color: #FFFFFF;
            border: 1px solid #D5D2C8;
            border-top: none;
            border-radius: 0 0 0.75rem 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        /* --- INTERACTIVE CARDS (UNIFIED) --- */
        .info-card {
            background-color: #EDEAE0;
            border: 1px solid #D5D2C8;
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-sizing: border-box;
            text-align: center;
            font-weight: 600;
            color: #333333;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            max-height: 120px; 
            overflow: hidden;
        }
        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .info-card.active {
            border-color: #00A896;
            box-shadow: 0 4px 8px rgba(0, 168, 150, 0.3);
            background-color: #E0F7F5;
            max-height: 5000px;
        }
        .card-title, .role-title, .node-title {
            font-size: 1.1em;
            margin-bottom: 0.6rem;
            color: #004085;
        }
        .card-description, .role-description, .node-description {
            font-weight: 400;
            font-size: 0.9em;
            color: #555555;
            margin-top: 0.5rem;
            display: none;
            text-align: left;
            word-break: break-word;
        }
        .active .card-description, .active .role-description, .active .node-description {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        .key-term-card .card-description { text-align: center; }

        /* --- Polished Table Styles --- */
        .styled-table {
            width: 100%;
            max-width: 100%;
            margin: 1.5rem auto;
            border-collapse: collapse;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .styled-table th, .styled-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border: none;
            border-bottom: 1px solid #e2e8f0;
        }
        .styled-table th {
            background-color: #f8fafc;
            font-weight: 700;
            color: #334155;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
        }
        .styled-table td {
            background-color: #FFFFFF;
            color: #475569;
        }
        .styled-table tbody tr:last-child td {
            border-bottom: none;
        }
        .styled-table .highlight {
            font-weight: 700;
            color: #00796B;
        }
        .styled-table td:first-child, .styled-table th:first-child {
            font-weight: 600;
            color: #334155;
        }
        
        /* --- KEYFRAMES --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* --- DOMAIN SPECIFIC STYLES --- */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 50vh;
            max-height: 500px;
            margin: auto;
            overflow: hidden;
        }
        .slider-container {
            width: 80%;
            max-width: 500px;
            margin: 2rem auto;
            text-align: center;
            background-color: #EDEAE0;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }
        .slider-container input[type="range"] { width: 100%; }

        .framework-journey-container, .hierarchy-chart-container, .incident-lifecycle-container, .flowchart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: #F8F5EF;
            border-radius: 0.5rem;
            max-width: 600px;
            margin: 1rem auto;
        }
        
        .framework-arrow, .hierarchy-line, .incident-lifecycle-arrow {
            width: 2px;
            height: 2rem;
            background-color: #D5D2C8;
        }
        
        .maturity-arrow-right {
            font-size: 2.5rem;
            color: #b0bec5;
            line-height: 1;
        }
        .risk-matrix-table th, .risk-matrix-table td {
            border: 1px solid #D5D2C8;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
        }
        .risk-matrix-table .low { background-color: #D4EDDA; color: #155724; }
        .risk-matrix-table .medium { background-color: #FFF3CD; color: #856404; }
        .risk-matrix-table .high { background-color: #F8D7DA; color: #721C24; }
        .risk-matrix-table .critical { background-color: #DC3545; color: #FFFFFF; }
        
        /* --- QUIZ STYLES --- */
        .quiz-question-container {
            background-color: #fff;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.07);
        }
        .quiz-option {
            display: block; width: 100%; text-align: left; padding: 1rem; margin-bottom: 0.5rem;
            border: 2px solid #e2e8f0; border-radius: 0.5rem; background-color: #f8fafc;
            cursor: pointer; transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover { border-color: #00A896; background-color: #E0F7F5; }
        .quiz-option.selected { border-color: #00796B; background-color: #B2DFDB; }
        .quiz-feedback { margin-top: 1rem; padding: 1rem; border-radius: 0.5rem; font-weight: 600; }
        .quiz-feedback.correct { background-color: #D4EDDA; color: #155724; border-left: 5px solid #28A745; }
        .quiz-feedback.incorrect { background-color: #F8D7DA; color: #721C24; border-left: 5px solid #DC3545; }
        .quiz-explanation { margin-top: 0.5rem; font-style: italic; color: #475569; }
        #quiz-results { background-color: #E0F7F5; border: 2px solid #00A896; padding: 2rem; text-align: center; border-radius: 0.75rem; }

        /* --- STYLES MERGED FROM DOMAIN 4 --- */
        .section-header {
            font-size: 2.5rem; /* Slightly larger font size */
        }
        .interactive-card {
            background-color: #EDEAE0;
            border: 1px solid #D5D2C8;
            transition: all 0.2s ease-in-out;
        }
        .interactive-card.active {
            border-color: #00A896; /* Vibrant Teal border */
            box-shadow: 0 4px 8px rgba(0, 168, 150, 0.3); /* Teal glow effect */
            background-color: #E0F7F5; /* Very light teal background */
        }
        .interactive-card .card-title {
            font-size: 1.15em;
            text-align: center;
            color: #004085; /* Dark blue for title */
        }
        
        /* Specific Card Sizing */
        .incident-plan-element-card, .comm-action-card, .drp-site-card, .post-incident-practice-card { flex: 1 1 300px; max-width: 300px; }
        .response-method-card, .ir-method-card { flex: 1 1 200px; max-width: 200px; }
        .dependency-card { flex: 1 1 350px; max-width: 350px; }
        .bcp-element-card, .forensic-method-card { flex: 1 1 300px; max-width: 300px; }
        .testing-type-card { flex: 1 1 250px; max-width: 250px; }
        .eradication-step-card, .recovery-step-card { flex: 1 1 200px; max-width: 200px; }
        .comm-stakeholder-card { flex: 1 1 300px; max-width: 300px; }
        .containment-method-card { flex: 1 1 22%; max-width: 250px; } /* Ensures 4 cards per row */
        
        .flowchart-container {
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .flowchart-container .interactive-card {
            background-color: #FFFFFF;
        }
        .flowchart-arrow {
            font-size: 2.5em;
            color: #D5D2C8;
            line-height: 1;
        }
        
        /* Incident Classification Card Styling */
        .incident-classification-card {
            text-align: left;
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .incident-classification-card.active {
            max-height: 500px; /* Allow expansion */
            filter: brightness(1.1);
        }
        .incident-classification-card .card-title { text-align: left; }
        .incident-classification-card .card-description { text-align: left; }
        .incident-classification-card[data-classification="critical"] { background-color: #FF4D4D; color: white; }
        .incident-classification-card[data-classification="high"] { background-color: #FFA500; color: white; }
        .incident-classification-card[data-classification="medium"] { background-color: #FFD700; color: #333; }
        .incident-classification-card[data-classification="low"] { background-color: #8BC34A; color: white; }
        .incident-classification-card.active[data-classification="critical"],
        .incident-classification-card.active[data-classification="high"],
        .incident-classification-card.active[data-classification="low"] {
            color: #333;
        }
        
        /* Key Terms Section Layout */
        #key-terms-grid-d4 {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(1, 1fr); /* Default to 1 column */
        }
        #key-terms-grid-d4 .key-term-card {
            max-width: 150px;
            width: 100%;
            min-height: 150px;
        }
        @media (min-width: 640px) { #key-terms-grid-d4 { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 768px) { #key-terms-grid-d4 { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 1280px) { #key-terms-grid-d4 { grid-template-columns: repeat(6, 1fr); } }

    </style>
</head>
<body class="leading-relaxed">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center py-6 bg-white rounded-lg shadow-lg mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-2">CISM Study Guide</h1>
            <p class="text-xl sm:text-2xl text-gray-600">Comprehensive Interactive Educational Resource for CISM Certification Exam</p>
        </header>

        <div class="flex flex-col md:flex-row gap-8">
            <aside class="md:w-1/4 lg:w-1/5">
                <nav id="master-navigation" class="bg-white p-4 rounded-lg shadow-md flex flex-col space-y-2 sticky top-4">
                    <button class="master-nav-item text-gray-700 active" data-domain-target="about-cism">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">CISM Introduction</span>
                            <span class="text-sm font-normal">Certification Overview</span>
                        </div>
                    </button>
                    <button class="master-nav-item text-gray-700" data-domain-target="domain-1">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">Domain 1</span>
                            <span class="text-sm font-normal">Governance</span>
                        </div>
                    </button>
                    <button class="master-nav-item text-gray-700" data-domain-target="domain-2">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">Domain 2</span>
                            <span class="text-sm font-normal">Risk Management</span>
                        </div>
                    </button>
                    <button class="master-nav-item text-gray-700" data-domain-target="domain-3">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">Domain 3</span>
                            <span class="text-sm font-normal">Program Development</span>
                        </div>
                    </button>
                    <button class="master-nav-item text-gray-700" data-domain-target="domain-4">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">Domain 4</span>
                            <span class="text-sm font-normal">Incident Management</span>
                        </div>
                    </button>
                    <button class="master-nav-item text-gray-700" data-domain-target="assessment">
                        <div class="flex flex-col">
                            <span class="font-bold text-base domain-title">Assessment</span>
                            <span class="text-sm font-normal">Test Your Knowledge</span>
                        </div>
                    </button>
                </nav>
            </aside>

            <main class="flex-1">
                <div id="domains-content-area">
                    <div id="about-cism" class="domain-content-section fade-in">
                        </div>

                    <div id="domain-1" class="domain-content-section hidden">
                        </div>
        
                    <div id="domain-2" class="domain-content-section hidden">
                        </div>

                    <div id="domain-3" class="domain-content-section hidden">
                         </div>

                    <div id="domain-4" class="domain-content-section hidden">
                        <header class="text-center py-8 bg-white rounded-lg shadow-md mb-8">
                            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-2">CISM Domain 4 Study Guide</h1>
                            <p class="text-xl sm:text-2xl text-gray-600">Incident Management</p>
                            <p class="text-md text-gray-500 mt-2">Preparing For and Responding to Information Security Incidents</p>
                        </header>

                        <nav class="bg-white p-4 rounded-lg shadow-md mb-8 flex justify-center sticky top-0 z-10 overflow-x-auto">
                            <button class="domain-nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200 active" data-target="introduction-d4">Introduction</button>
                            <button class="domain-nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="incident-readiness-d4">Incident Readiness</button>
                            <button class="domain-nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="incident-operations-d4">Incident Operations</button>
                            <button class="domain-nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="key-terms-d4">Key Terms</button>
                            <button class="domain-nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="domain-summary-d4">Domain Summary</button>
                        </nav>

                        <main>
                            <section id="introduction-d4" class="content-section fade-in">
                                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Introduction to CISM Domain 4</h2>
                                <div class="p-6 bg-white rounded-lg shadow-md">
                                    <p class="text-gray-700 mb-4">Welcome to the interactive study guide for CISM Domain 4: Incident Management. This domain is critical for information security managers, as it focuses on the organization's ability to effectively prepare for, detect, respond to, and recover from information security incidents. In today's dynamic threat landscape, a robust incident management capability is not just a best practice; it's a fundamental requirement for business resilience and continuity.</p>
                                    <p class="text-gray-700">Throughout this guide, you will explore the dual aspects of incident management: <strong>Readiness</strong> (proactive planning and preparation) and <strong>Operations</strong> (reactive execution during an incident). You'll delve into the intricacies of incident response planning, business impact analysis, disaster recovery, and the practical application of tools and techniques for investigation, containment, and recovery. By mastering these areas, you will gain the expertise to minimize the impact of security incidents, ensure organizational stability, and facilitate continuous improvement in your security posture.</p>
                                </div>
                            </section>

                            <section id="incident-readiness-d4" class="content-section hidden">
                                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Section A: Incident Management Readiness</h2>
                                <p class="mb-8 text-gray-700">Effective incident management begins long before an incident occurs. This section covers the crucial planning, documentation, and preparation activities that lay the groundwork for a swift and organized response.</p>
                                <div class="space-y-4">
                                    <div class="bg-white rounded-lg shadow-md">
                                        <button class="accordion-button w-full">1. Incident Response Plan (IRP) / Incident Management Plan (IMP)<span class="accordion-icon text-2xl">+</span></button>
                                        <div class="accordion-content hidden p-6">
                                            <div id="d4-plan-elements" class="flex flex-wrap justify-center gap-4 mb-6" data-interactive-group="plan-elements"></div>
                                            <div id="d4-response-methods" class="flex flex-wrap justify-center gap-4 mb-6" data-interactive-group="response-methods"></div>
                                            <div id="d4-incident-phases" class="flowchart-container" data-interactive-group="incident-phases"></div>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-lg shadow-md">
                                         <button class="accordion-button w-full">2. Business Impact Analysis (BIA)<span class="accordion-icon text-2xl">+</span></button>
                                         <div class="accordion-content hidden p-6" >
                                            <div id="d4-bcp-elements" class="flex flex-wrap justify-center gap-4 mb-6" data-interactive-group="bcp-elements"></div>
                                         </div>
                                    </div>
                                    </div>
                            </section>

                            <section id="incident-operations-d4" class="content-section hidden">
                                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Section B: Incident Management Operations</h2>
                                <p class="mb-8 text-gray-700">This section describes the real-time execution of the incident response plan when a security incident is detected.</p>
                                </section>

                            <section id="key-terms-d4" class="content-section hidden">
                                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Key Terms</h2>
                                <p class="mb-8 text-gray-700">Test your knowledge of key terms in Incident Management with these interactive flashcards. Click on a card to reveal its definition.</p>
                                <div id="key-terms-grid-d4" class="grid" data-interactive-group="key-terms">
                                    </div>
                            </section>

                            <section id="domain-summary-d4" class="content-section hidden">
                                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Domain Summary</h2>
                                <div class="p-6 bg-white rounded-lg shadow-md">
                                    <p class="text-gray-700 mb-4">CISM Domain 4: Incident Management, emphasizes the critical role of information security managers in preparing for, responding to, and recovering from information security incidents. It's a highly practical domain that covers the entire lifecycle of an incident, from proactive planning to post-event analysis.</p>
                                    <p class="text-gray-700 mb-4">The domain is split into two key areas: <strong>Incident Management Readiness</strong> focuses on the foundational work, including developing comprehensive Incident Response Plans (IRPs), conducting Business Impact Analyses (BIAs) to understand critical assets and their recovery needs (RTOs/RPOs), and establishing robust Business Continuity Plans (BCPs) and Disaster Recovery Plans (DRPs). It also covers establishing clear incident classification criteria and the importance of regular testing, evaluation, and training for the entire incident management team.</p>
                                    <p class="text-gray-700"><strong>Incident Management Operations</strong> delves into the active phases of incident handling. This includes leveraging various security tools (SIEM, EDR, IDS/IPS), applying forensic methodologies for investigation and root cause analysis, implementing effective containment strategies, and managing multi-faceted communications with both internal and external stakeholders. Finally, it assesses the crucial steps of eradicating threats, recovering systems to a secure state, and conducting thorough post-incident reviews to identify lessons learned and drive continuous improvement in the organization's security posture. A strong grasp of this domain is essential for any CISM professional looking to minimize business disruption and enhance organizational resilience in the face of security challenges.</p>
                                </div>
                            </section>
                        </main>
                    </div>

                    <div id="assessment" class="domain-content-section hidden">
                         </div>
                </div>
            </main>
        </div>

        <footer class="text-center py-6 mt-8 text-gray-500 text-sm">
            <p>&copy; 2025 CISM Unified Study Guide. All rights reserved. For educational purposes only.</p>
        </footer>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Centralized Data Store (existing data is omitted for brevity but would be here) ---
    const CISM_DATA = {
        // ... CISM_DATA for about, domain-1, domain-2, domain-3, assessment ...
        domain4: {
            'plan-elements': {
                scope: { description: "Defines what constitutes an 'information security incident' and which systems, networks, data, and business processes are covered. It clarifies the boundaries of the incident response team's authority." },
                objectives: { description: "Outlines the goals of the IRP, such as minimizing damage, restoring operations quickly, protecting reputation, and complying with legal obligations." },
                roles: { description: "Clearly defines who does what during an incident, including the IRT lead, technical specialists, communication lead, and legal counsel, to ensure accountability and coordination." }
            },
            'bcp-elements': {
                rto: { description: "The maximum tolerable duration of time that a system, application, or network can be down after a disaster or incident without causing unacceptable harm to the business. Example: An e-commerce platform has an RTO of 4 hours." },
                rpo: { description: "The maximum tolerable amount of data that can be lost from an IT service due to a major incident, indicating how recent backups need to be. Example: A customer database has an RPO of 1 hour." }
            },
            keyTerms: [
                { term: "IRP", definition: "A documented set of procedures for detecting, analyzing, containing, eradicating, and recovering from information security incidents." },
                { term: "BIA", definition: "A process to identify and evaluate the potential effects of disruptive events on an organization's critical business functions." },
                { term: "RTO", definition: "The maximum acceptable downtime for a system or business function after a disruption." },
                { term: "RPO", definition: "The maximum acceptable amount of data that can be lost from an IT service due to a major incident, typically measured in time (e.g., 1 hour of data loss)." },
                { term: "BCP", definition: "A comprehensive plan outlining how an organization will maintain essential business functions during and after a significant disruption, regardless of cause." },
                { term: "DRP", definition: "A detailed technical plan focused on restoring IT systems, applications, and data after a disaster, aligning with BIA-defined RTOs and RPOs." },
                { term: "SIEM", definition: "A security solution that collects, aggregates, and analyzes security logs and events from various sources to provide real-time threat detection and security monitoring." },
                { term: "Chain of Custody", definition: "The chronological documentation showing the seizure, custody, control, transfer, analysis, and disposition of physical or electronic evidence." },
                { term: "Containment", definition: "The phase of incident response focused on limiting the scope and impact of a security incident to prevent further damage or spread." },
                { term: "Eradication", definition: "The phase of incident response focused on completely removing the malicious elements from affected systems and addressing the root cause vulnerability." },
            ]
        }
    };

    // --- Master Controller ---
    const mainContentArea = document.getElementById('domains-content-area');

    function initDomain4(domainContainer) {
        // This function will now run the original, self-contained script logic for Domain 4
        // All event listeners and data are scoped within this function to avoid conflicts.
        
        const data = CISM_DATA.domain4;

        // Navigation Logic for Domain 4's sub-sections
        const navButtons = domainContainer.querySelectorAll('.domain-nav-item');
        const contentSections = domainContainer.querySelectorAll('.content-section');
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const targetId = button.dataset.target;
                contentSections.forEach(section => {
                    section.classList.toggle('hidden', section.id !== targetId);
                    section.classList.toggle('fade-in', section.id === targetId);
                });
                if (targetId === 'key-terms-d4') {
                    renderKeyTerms();
                }
            });
        });

        // Accordion Logic for Domain 4
        domainContainer.querySelectorAll('.accordion-button').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const icon = button.querySelector('.accordion-icon');
                const isHidden = content.classList.toggle('hidden');
                content.classList.toggle('fade-in', !isHidden);
                icon.textContent = isHidden ? '+' : '–';
            });
        });

        // Interactive Card Logic for Domain 4
        domainContainer.querySelectorAll('[data-interactive-group]').forEach(group => {
            group.addEventListener('click', e => {
                const card = e.target.closest('.interactive-card');
                if (!card) return;

                e.stopPropagation();
                const groupName = group.dataset.interactiveGroup;
                const cardKey = card.dataset.key;
                const descriptionDiv = card.querySelector('.card-description');
                const isActive = card.classList.contains('active');
                
                // Deactivate all other cards in the same group
                group.querySelectorAll('.interactive-card').forEach(otherCard => {
                    if (otherCard !== card) {
                        otherCard.classList.remove('active');
                        const otherDesc = otherCard.querySelector('.card-description');
                        if(otherDesc) otherDesc.innerHTML = '';
                    }
                });

                // Toggle the current card
                card.classList.toggle('active', !isActive);
                if (!isActive && descriptionDiv && data[groupName] && data[groupName][cardKey]) {
                    descriptionDiv.innerHTML = `<p>${data[groupName][cardKey].description}</p>`;
                } else if (descriptionDiv) {
                    descriptionDiv.innerHTML = '';
                }
            });
        });

        // Key Terms Renderer for Domain 4
        function renderKeyTerms() {
            const container = domainContainer.querySelector('#key-terms-grid-d4');
            if (container.children.length === 0) { // Prevents re-rendering
                data.keyTerms.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'interactive-card key-term-card';
                    card.innerHTML = `<h3 class="card-title">${item.term}</h3><div class="card-description"><p>${item.definition}</p></div>`;
                    container.appendChild(card);
                });
            }
        }
    }
    
    // ... Other init functions from baseline ...

    function setupDomain(domainId) {
        const domainContainer = document.getElementById(domainId);
        if (!domainContainer || domainContainer.dataset.initialized === 'true') return;

        if (domainId === 'domain-4') {
            initDomain4(domainContainer);
        } else {
            // Logic for other domains from baseline
        }
        
        domainContainer.dataset.initialized = 'true';
    }
    
    // Master Navigation from baseline
    document.getElementById('master-navigation').addEventListener('click', (e) => {
        const targetButton = e.target.closest('.master-nav-item');
        if (!targetButton) return;
        document.querySelectorAll('#master-navigation .master-nav-item').forEach(btn => btn.classList.remove('active'));
        targetButton.classList.add('active');
        const targetDomainId = targetButton.dataset.domainTarget;
        document.querySelectorAll('.domain-content-section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(targetDomainId)?.classList.remove('hidden');
        setupDomain(targetDomainId);
    });
    
    // Initial Load
    setupDomain('about-cism'); // Or whichever domain should be active first
});
</script>
</body>
</html>
