<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISM 2025: Domain 2 - Information Security Risk Management (Designer Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Global Styles & Font Import */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap');

        :root {
            --dark-navy-bg: #0a101f;
            --surface-color: #10192b;
            --accent-glow: #00bfff; /* Deep Sky Blue */
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #2d3748;
            --shadow-color: rgba(0, 191, 255, 0.1);
            --shadow-color-hover: rgba(0, 191, 255, 0.3);
            --transition-fast: all 0.3s ease-in-out;
            --color-red: #FF6384;
            --color-yellow: #FFCD56;
            --color-green: #4BC0C0;
            --color-purple: #9966FF;
            --color-orange: #DAA520;
            --color-blue-alt: #6A5ACD;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-navy-bg);
            background-image: radial-gradient(circle at top, #10192b, var(--dark-navy-bg));
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://www.transparenttextures.com/patterns/subtle-noise.png');
            opacity: 0.03;
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
        }

        /* Header */
        header.main-header {
            background: linear-gradient(180deg, var(--surface-color), #0a101fcc);
            border-bottom: 1px solid var(--border-color);
            border-radius: 0.75rem;
            position: relative;
        }
        
        .header-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 200px;
            background: var(--accent-glow);
            border-radius: 50%;
            filter: blur(100px);
            transform: translate(-50%, -50%);
            opacity: 0.1;
            animation: pulseGlow 8s infinite alternate;
            z-index: 0;
        }

        @keyframes pulseGlow {
            from { opacity: 0.05; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 0.15; transform: translate(-50%, -50%) scale(1.2); }
        }

        header.main-header .header-content {
            position: relative;
            z-index: 1;
        }

        header.main-header h1 {
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
            text-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
        }

        /* Main Content Area */
        main {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
            padding: 2rem;
        }
        
        /* Section Header */
        .section-header {
            border-left: 6px solid var(--accent-glow);
            padding-left: 1.25rem;
            font-size: 2.5rem;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
            color: var(--text-primary);
        }
        
        /* Navigation Tabs */
        .nav-item {
            border: 2px solid transparent;
            border-radius: 0.5rem;
            transition: var(--transition-fast);
            position: relative;
            overflow: hidden;
            color: var(--text-secondary);
            font-weight: 600;
        }
        .nav-item:not(.active):hover {
            border-color: var(--accent-glow);
            background-color: rgba(0, 191, 255, 0.05);
            color: var(--text-primary);
        }
        .nav-item.active {
            background-color: var(--accent-glow);
            color: var(--dark-navy-bg);
            font-weight: 700;
            box-shadow: 0 0 20px var(--shadow-color);
        }

        /* Enhanced Fade-in Animation */
        .fade-in {
            animation: enhancedFadeIn 0.7s ease-out;
        }
        @keyframes enhancedFadeIn {
            from { opacity: 0; transform: translateY(25px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* General content box */
        .content-box {
            background-color: rgba(10, 16, 31, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        /* Accordion Styles */
        .accordion-button {
            background-color: var(--dark-navy-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: var(--transition-fast);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left;
        }
        .accordion-button:hover {
            border-color: var(--accent-glow);
            background-color: rgba(0, 191, 255, 0.05);
        }
        .accordion-icon {
            transition: transform 0.3s ease-in-out;
        }
        .accordion-button.open .accordion-icon {
            transform: rotate(45deg);
        }
        .accordion-content {
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 0.75rem 0.75rem;
            padding: 1.5rem;
            margin-top: -0.75rem;
            animation: enhancedFadeIn 0.5s ease-in-out;
        }

        /* --- DESIGN STANDARDIZATION --- */
        /* Standardize sub-headers inside accordions */
        .accordion-content h4 {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 1.5rem; /* 24px */
            margin-bottom: 0.75rem; /* 12px */
            padding-bottom: 0.5rem; /* 8px */
            border-bottom: 1px solid var(--border-color);
        }
        /* Standardize paragraph spacing */
        .accordion-content p, .accordion-content ul {
            margin-bottom: 1rem; /* 16px */
            color: var(--text-secondary);
        }
        /* Custom Bullet Points */
        .accordion-content ul {
            list-style: none;
            padding-left: 1.25rem; /* 20px */
        }
        .accordion-content ul li {
            position: relative;
            padding-left: 1.25rem; /* 20px */
            margin-bottom: 0.5rem; /* 8px */
        }
        .accordion-content ul li::before {
            content: '•';
            position: absolute;
            left: 0;
            top: 0;
            color: var(--accent-glow);
            font-size: 1.25rem; /* 20px */
            line-height: 1.6;
        }
        /* --- END DESIGN STANDARDIZATION --- */

        /* Unified Interactive Card Styles */
        .unified-card {
            background: rgba(10, 16, 31, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            transition: var(--transition-fast);
            padding: 1.5rem;
            cursor: pointer;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }
        .unified-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4), 0 0 25px var(--shadow-color-hover);
            border-color: var(--accent-glow);
        }
        .unified-card.active {
            border-color: var(--accent-glow);
            box-shadow: 0 0 25px var(--shadow-color-hover);
            background-color: rgba(0, 191, 255, 0.1);
            transform: scale(1.02);
        }
        .unified-card .card-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 0.6rem;
            color: var(--accent-glow);
            text-align: center;
            transition: var(--transition-fast);
        }
        .unified-card:hover .card-title {
            text-shadow: 0 0 8px var(--accent-glow);
        }
        .unified-card .card-description {
            font-weight: 400;
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            display: none;
            text-align: left;
            width: 100%;
        }
        .unified-card.active .card-description {
            display: block;
            animation: enhancedFadeIn 0.5s ease-in-out;
        }

        /* Specific Card Widths */
        .risk-framework-card { width: 200px; }
        .risk-response-card { width: 200px; }
        .risk-method-card { width: 250px; }
        .key-term-card { width: 150px; }
        .role-node { width: 220px; }
        .flow-node { 
            width: 150px; 
            min-height: 160px; /* Uniform height for flowchart cards */
            display: flex;
            flex-direction: column;
        }
        .flow-node .card-description {
            flex-grow: 1; /* Allows description to fill space */
        }


        /* Chart & Interactive Element Containers */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 40vh;
            margin: 1rem auto;
        }
        
        /* Flowchart & Hierarchy Styles */
        .flow-arrow, .hierarchy-line {
            width: 2px;
            height: 2rem;
            background-color: var(--border-color);
            position: relative;
        }
        .flow-arrow::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(50%) rotate(135deg);
            width: 8px;
            height: 8px;
            border-top: 2px solid var(--border-color);
            border-right: 2px solid var(--border-color);
        }
        .hierarchy-line-split {
            width: 60%;
            height: 2px;
            background-color: var(--border-color);
            position: relative;
            margin: 1rem 0;
        }

        /* Table Styles */
        .dark-table {
            width: 100%;
            max-width: 600px;
            margin: 1rem auto;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .dark-table th, .dark-table td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: center;
        }
        .dark-table th {
            background-color: var(--dark-navy-bg);
            font-weight: 600;
            color: var(--text-primary);
        }
        .dark-table td {
            background-color: var(--surface-color);
            color: var(--text-secondary);
        }
        .dark-table .risk-level-low { color: var(--color-green); }
        .dark-table .risk-level-medium { color: var(--color-yellow); }
        .dark-table .risk-level-high { color: var(--color-red); }
        .dark-table .critical { color: var(--color-red); font-weight: bold; }
        .dark-table .trend-up::before { content: '▲ '; color: var(--color-red); }
        .dark-table .trend-down::before { content: '▼ '; color: var(--color-green); }
        .dark-table .trend-stable::before { content: '● '; color: var(--color-yellow); }

        /* Quantitative Calculator Styles */
        .calculator-form input {
            background-color: var(--dark-navy-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 0.5rem;
            padding: 0.5rem;
            transition: var(--transition-fast);
        }
        .calculator-form input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-glow);
            border-color: var(--accent-glow);
        }
        .calculator-result {
            color: var(--accent-glow);
            font-weight: 700;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .unified-card {
                flex: 1 1 100%;
                width: 100% !important;
                max-width: 100%;
            }
        }
    </style>
</head>
<body class="leading-relaxed">
    <div class="container mx-auto p-4 sm:p-6 lg:p-12">
        <header class="main-header text-center py-10 mb-10 overflow-hidden">
            <div class="header-glow"></div>
            <div class="header-content">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-2">CISM Domain 2 Study Guide</h1>
                <p class="text-xl sm:text-2xl text-gray-400">Information Security Risk Management</p>
                <p class="text-md text-gray-500 mt-2">Your Interactive Study Guide for Proactive Security Protection</p>
            </div>
        </header>

        <nav class="p-2 rounded-lg mb-10 flex flex-wrap justify-center sticky top-4 z-10 gap-2 sm:gap-4 bg-black/30 backdrop-blur-sm border border-gray-700/50">
            <button class="nav-item px-4 py-2 text-lg font-medium transition-colors duration-200 active" data-target="introduction">Introduction</button>
            <button class="nav-item px-4 py-2 text-lg font-medium transition-colors duration-200" data-target="risk-assessment">Risk Assessment</button>
            <button class="nav-item px-4 py-2 text-lg font-medium transition-colors duration-200" data-target="risk-response">Risk Response</button>
            <button class="nav-item px-4 py-2 text-lg font-medium transition-colors duration-200" data-target="key-terms">Key Terms</button>
            <button class="nav-item px-4 py-2 text-lg font-medium transition-colors duration-200" data-target="domain-summary">Domain Summary</button>
        </nav>

        <main id="content-area">
            <!-- Introduction Section -->
            <section id="introduction" class="content-section">
                <h2 class="text-3xl font-bold section-header mb-6">Introduction to CISM Domain 2</h2>
                <div class="content-box">
                    <p>Welcome to the interactive study guide for CISM Domain 2: Information Security Risk Management. This domain is the cornerstone of effective information security, focusing on how organizations identify, assess, respond to, and monitor risks to their valuable information assets. A strong grasp of these principles is not just theoretical; it's crucial for making informed, business-aligned decisions that proactively protect the enterprise.</p>
                    <p>Throughout this guide, you will explore the dynamic threat landscape, learn how to analyze vulnerabilities, apply various risk assessment methodologies, and understand the critical strategies for responding to risks. We will also delve into the importance of clear risk and control ownership and the continuous process of monitoring and reporting. This interactive format is designed to enhance your learning experience, making complex topics more accessible and engaging.</p>
                </div>
            </section>

            <!-- Information Security Risk Assessment Section -->
            <section id="risk-assessment" class="content-section hidden">
                <h2 class="text-3xl font-bold section-header mb-6">Section A: Information Security Risk Assessment</h2>
                <p class="mb-8 text-gray-400">Information security risk assessment is the systematic process of identifying potential threats and vulnerabilities, analyzing their potential impact, and determining the likelihood of their occurrence. It's about understanding "what could go wrong" and "how bad it could be".</p>

                <div class="space-y-4">
                    <!-- Emerging Risk and Threat Landscape -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>1. Emerging Risk and Threat Landscape</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                            <p>To effectively manage risk, a security manager must first understand the environment from which threats emerge. This subsection covers the process of risk identification, which involves understanding the different categories of risk, the motivations of various threat actors, and the paths (or vectors) they use to attack an organization. We will also explore the critical role of threat intelligence in staying ahead of new and emerging threats, and how to use the fundamental risk formula (Risk = Likelihood x Impact) to begin prioritizing efforts.</p>
                             
                            <h4>a. Understand emerging and evolving threats (e.g., ransomware, insider threats, third-party risks).</h4>
                            <p>Explore the common distribution of various emerging threats and how they impact organizations:</p>
                            <div class="chart-container mb-6">
                                <canvas id="threatDistributionChart"></canvas>
                            </div>
                            <div class="flex flex-wrap justify-center gap-4 mb-4">
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="ransomwareFocus" style="background-color: var(--color-red); color: white;">Ransomware</button>
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="insiderFocus" style="background-color: var(--color-yellow); color: var(--dark-navy-bg);">Insider Threats</button>
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="thirdPartyFocus" style="background-color: var(--color-purple); color: white;">Third-Party Risks</button>
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="phishingFocus" style="background-color: var(--color-green); color: var(--dark-navy-bg);">Phishing</button>
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="ddosFocus" style="background-color: var(--color-blue-alt); color: white;">DDoS</button>
                                <button class="toggle-chart-data px-4 py-2 rounded-full text-sm font-semibold" data-chart-id="threatDistributionChart" data-data-set="aptFocus" style="background-color: var(--color-orange); color: var(--dark-navy-bg);">APT</button>
                            </div>
                            <div id="threat-explanation" class="text-gray-400 text-sm italic mt-2 text-center">This chart illustrates a simulated distribution of common emerging threats. Use the buttons to view different focuses.</div>

                            <h4>b. Risk Identification and Frameworks</h4>
                            <p>The process begins by identifying the organization's valuable assets, the threats that could harm them, and the vulnerabilities (weaknesses) that could be exploited. Frameworks like ISO 31000 and the NIST Risk Management Framework (RMF) provide structured templates for this process, ensuring a consistent and comprehensive approach.</p>

                            <h4>c. Categories of Risk</h4>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card" data-group="risk-categories" style="width: 220px;">
                                    <span class="card-title">Strategic Risk</span>
                                    <div class="card-description">Threatens the achievement of major business goals.</div>
                                </div>
                                <div class="unified-card" data-group="risk-categories" style="width: 220px;">
                                    <span class="card-title">Operational Risk</span>
                                    <div class="card-description">Relates to failures in day-to-day processes, people, or systems.</div>
                                </div>
                                <div class="unified-card" data-group="risk-categories" style="width: 220px;">
                                    <span class="card-title">Reputational Risk</span>
                                    <div class="card-description">Damages customer trust and brand image.</div>
                                </div>
                                <div class="unified-card" data-group="risk-categories" style="width: 220px;">
                                    <span class="card-title">Compliance Risk</span>
                                    <div class="card-description">Arises from failing to adhere to laws and regulations, leading to fines and penalties.</div>
                                </div>
                                <div class="unified-card" data-group="risk-categories" style="width: 220px;">
                                    <span class="card-title">Technology Risk</span>
                                    <div class="card-description">Associated with system failures, data breaches, and other technology issues.</div>
                                </div>
                            </div>

                            <h4>d. Threat Actors and Vectors</h4>
                             <p><strong>Threat Actors:</strong> The individuals or groups who pose a threat. Their motivations are key to understanding the risks they present.</p>
                             <ul>
                                <li>Examples: Script Kiddies (low skill, seeking notoriety), Hacktivists (mission-driven), Criminal Syndicates (profit-driven), Advanced Persistent Threats (APTs) (often state-sponsored, highly skilled, and well-funded), and Insiders (disgruntled or negligent employees).</li>
                            </ul>
                             <p><strong>Threat Vector:</strong> The path or method an attacker uses to exploit a vulnerability.</p>
                             <ul>
                                <li>Examples: Phishing emails, unpatched software, removable media (like USB drives), and compromised third-party vendors.</li>
                            </ul>
                            <p><strong>Attack Surface:</strong> The sum of all possible entry points an attacker could use. The goal is to reduce the attack surface.</p>

                            <h4>e. Threat Intelligence</h4>
                            <p>This is the practice of gathering and analyzing information about current and emerging threats to be proactive rather than reactive. Click the cards below to learn more.</p>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card" data-group="threat-intel" style="width: 250px;">
                                    <span class="card-title">Threat Intelligence Sources</span>
                                    <div class="card-description">Sources include open-source feeds (from government agencies like CISA), proprietary/commercial feeds, and Information Sharing and Analysis Centers (ISACs).</div>
                                </div>
                                <div class="unified-card" data-group="threat-intel" style="width: 250px;">
                                    <span class="card-title">Indicators of Compromise (IoCs)</span>
                                    <div class="card-description">Forensic evidence that a security incident has occurred (e.g., a malicious file hash or IP address).</div>
                                </div>
                                <div class="unified-card" data-group="threat-intel" style="width: 250px;">
                                    <span class="card-title">STIX/TAXII</span>
                                    <div class="card-description">A standardized language (STIX) and protocol (TAXII) for sharing machine-readable threat intelligence between systems.</div>
                                </div>
                            </div>

                            <h4>f. Risk Formula and Risk Register</h4>
                            <p>The fundamental formula for risk is: <strong>Risk = Likelihood × Impact</strong>. This helps in prioritizing which risks to address first. The <strong>Risk Register</strong> is a living document, often a spreadsheet, used to track all identified risks. It typically includes a description of the risk, its likelihood, impact, owner, and the planned response.</p>
                        </div>
                    </div>

                    <!-- Vulnerability and Control Deficiency Analysis -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>2. Vulnerability and Control Deficiency Analysis</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                            <p>Once threats are understood, the focus shifts inward to the organization's own weaknesses. This subsection covers the methods used to find vulnerabilities and deficiencies in existing security controls. We will explore the difference between automated vulnerability scans and manual penetration tests, and how security control baselines are used to ensure a consistent and measurable level of security across the enterprise.</p>
                            <h4>a. Identifying Vulnerabilities</h4>
                            <p>A vulnerability is a weakness in a system, process, or policy that can be exploited by a threat. Click the cards for methods of finding them:</p>
                             <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card" data-group="vuln-methods" style="width: 220px;">
                                    <span class="card-title">Vulnerability Scans</span>
                                    <div class="card-description">Automated tools that check systems for known weaknesses.</div>
                                </div>
                                <div class="unified-card" data-group="vuln-methods" style="width: 220px;">
                                    <span class="card-title">Penetration Tests</span>
                                    <div class="card-description">An "ethical hack" where a security professional simulates a real-world attack to find exploitable vulnerabilities.</div>
                                </div>
                                <div class="unified-card" data-group="vuln-methods" style="width: 220px;">
                                    <span class="card-title">Security Audits</span>
                                    <div class="card-description">Formal reviews to assess compliance with security standards.</div>
                                </div>
                            </div>
                            <h4>b. Vulnerability Scans vs. Penetration Tests</h4>
                            <p>This is a key distinction for the CISM exam. A vulnerability scan is automated and identifies potential weaknesses based on a database of known issues. It's like a fire alarm that tells you there might be smoke. A penetration test is manual and attempts to exploit the identified weaknesses to see how much damage could be done. It's like a firefighter actually testing the sprinklers and fire doors to see if they work. A pen test is the best way to assess risk from a series of vulnerabilities in related systems.</p>
                            <h4>c. Common Vulnerability Sources</h4>
                             <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card" data-group="vuln-sources" style="width: 220px;">
                                    <span class="card-title">CVE</span>
                                    <div class="card-description">(Common Vulnerabilities and Exposures): A dictionary of publicly known security vulnerabilities.</div>
                                </div>
                                <div class="unified-card" data-group="vuln-sources" style="width: 220px;">
                                    <span class="card-title">CVSS</span>
                                    <div class="card-description">(Common Vulnerability Scoring System): A standardized system for rating the severity of vulnerabilities, typically on a scale of 0-10.</div>
                                </div>
                                <div class="unified-card" data-group="vuln-sources" style="width: 220px;">
                                    <span class="card-title">NVD</span>
                                    <div class="card-description">(National Vulnerability Database): A comprehensive U.S. government repository of vulnerability management data.</div>
                                </div>
                            </div>
                            <h4>d. Security Control Baselines</h4>
                            <p>A baseline is a predefined minimum set of security controls that must be applied to all systems (or systems of a certain classification). It ensures a consistent, standardized level of security and provides a clear benchmark for audits.</p>
                            <h4>e. Map vulnerabilities to threats and evaluate potential impacts.</h4>
                            <p>Understand which threats could exploit identified vulnerabilities and the potential impact on confidentiality, integrity, availability, and overall business operations. See the example mapping below:</p>
                            <div class="content-box">
                                <h6 class="text-md font-semibold text-white mb-4 text-center">Sample Vulnerability-Threat-Impact Mapping</h6>
                                <div class="flex flex-wrap justify-center gap-4">
                                    <!-- Scenario 1 -->
                                    <div class="flow-scenario flex flex-col items-center gap-2" data-scenario-id="0">
                                        <div class="unified-card flow-node" data-group="flow-0" data-node-type="vulnerability"><span class="card-title">Unpatched Server</span><div class="card-description">Servers with outdated software are prime targets for attackers.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-0" data-node-type="threat"><span class="card-title">RCE</span><div class="card-description">Remote Code Execution allows an attacker to take full control.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-0" data-node-type="impact"><span class="card-title">Data Breach</span><div class="card-description">Confidentiality, Integrity, Availability impact.</div></div>
                                    </div>
                                    <!-- Scenario 2 -->
                                    <div class="flow-scenario flex flex-col items-center gap-2" data-scenario-id="1">
                                        <div class="unified-card flow-node" data-group="flow-1" data-node-type="vulnerability"><span class="card-title">Weak Passwords</span><div class="card-description">Simple or reused passwords make accounts easy targets.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-1" data-node-type="threat"><span class="card-title">Credential Stuffing</span><div class="card-description">Using stolen passwords from other breaches to gain access.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-1" data-node-type="impact"><span class="card-title">Unauthorized Access</span><div class="card-description">Confidentiality, Integrity impact.</div></div>
                                    </div>
                                    <!-- Scenario 3 -->
                                    <div class="flow-scenario flex flex-col items-center gap-2" data-scenario-id="2">
                                        <div class="unified-card flow-node" data-group="flow-2" data-node-type="vulnerability"><span class="card-title">No Encryption</span><div class="card-description">Storing sensitive data without encryption.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-2" data-node-type="threat"><span class="card-title">Physical Theft</span><div class="card-description">An attacker physically steals a storage device.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-2" data-node-type="impact"><span class="card-title">Data Exposure</span><div class="card-description">Confidentiality impact.</div></div>
                                    </div>
                                    <!-- Scenario 4 -->
                                    <div class="flow-scenario flex flex-col items-center gap-2" data-scenario-id="3">
                                        <div class="unified-card flow-node" data-group="flow-3" data-node-type="vulnerability"><span class="card-title">Single Point of Failure</span><div class="card-description">A critical component whose failure would cause an outage.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-3" data-node-type="threat"><span class="card-title">Hardware Failure / DDoS</span><div class="card-description">Accidental or malicious event causing disruption.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-3" data-node-type="impact"><span class="card-title">Service Outage</span><div class="card-description">Availability impact.</div></div>
                                    </div>
                                    <!-- Scenario 5 -->
                                    <div class="flow-scenario flex flex-col items-center gap-2" data-scenario-id="4">
                                        <div class="unified-card flow-node" data-group="flow-4" data-node-type="vulnerability"><span class="card-title">No Awareness Training</span><div class="card-description">Employees are not trained to spot common attacks.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-4" data-node-type="threat"><span class="card-title">Phishing</span><div class="card-description">Deceptive emails to trick users into revealing information.</div></div>
                                        <div class="flow-arrow hidden"></div>
                                        <div class="unified-card flow-node hidden" data-group="flow-4" data-node-type="impact"><span class="card-title">Credential Theft</span><div class="card-description">Confidentiality, Integrity, Financial impact.</div></div>
                                    </div>
                                </div>
                                <p class="text-gray-400 text-sm italic mt-4 text-center">Click on a card to see the potential threat and impact.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Assessment and Analysis -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>3. Risk Assessment and Analysis</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                            <p>This is where the identified threats, vulnerabilities, and impacts are formally analyzed to quantify or qualify the risk.</p>
                            <h4>a. Apply qualitative, quantitative, and hybrid risk assessment methods.</h4>
                            <p>Explore the characteristics of different risk assessment methods:</p>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card risk-method-card" data-group="risk-method"><span class="card-title">Qualitative</span><div class="card-description">Uses descriptive terms (e.g., high, medium, low) for likelihood and impact. It's subjective but quick and often used for initial assessments or when precise data is unavailable. Good for prioritization.</div></div>
                                <div class="unified-card risk-method-card" data-group="risk-method"><span class="card-title">Quantitative</span><div class="card-description">Assigns numerical values (e.g., monetary cost, probability percentages) to likelihood and impact. It aims to provide a more objective and measurable view of risk. Useful for cost-benefit analysis (e.g., SLE, ARO, ALE).</div></div>
                                <div class="unified-card risk-method-card" data-group="risk-method"><span class="card-title">Hybrid</span><div class="card-description">Combines elements of both qualitative and quantitative approaches. Often, qualitative assessments are used to identify and prioritize risks, and then quantitative analysis is applied to the most critical risks for detailed analysis.</div></div>
                            </div>
                            
                            <h4>b. Risk Assessment vs. Risk Analysis</h4>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card risk-method-card" data-group="risk-definitions-2">
                                    <span class="card-title">Risk Assessment</span>
                                    <div class="card-description">The overall process of identifying, analyzing, and evaluating risk. It's the strategic overview.</div>
                                </div>
                                <div class="unified-card risk-method-card" data-group="risk-definitions-2">
                                    <span class="card-title">Risk Analysis</span>
                                    <div class="card-description">The specific step within risk assessment where you evaluate the likelihood and impact of an identified risk. It's the tactical deep dive.</div>
                                </div>
                            </div>

                            <h4>c. Use standardized risk frameworks (e.g., ISO/IEC 27005, NIST SP 800-30, FAIR, OCTAVE).</h4>
                            <p>These frameworks provide structure and consistency for risk management processes. Click on a card to learn more:</p>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card risk-framework-card" data-group="risk-framework"><span class="card-title">ISO/IEC 27005</span><div class="card-description">Provides guidelines for information security risk management. It supports the general concepts specified in ISO/IEC 27001 (for ISMS) and is designed to assist the satisfactory implementation of information security based on a risk management approach.</div></div>
                                <div class="unified-card risk-framework-card" data-group="risk-framework"><span class="card-title">NIST SP 800-30</span><div class="card-description">A guide for conducting risk assessments, developed by the National Institute of Standards and Technology (NIST). It provides a systematic approach to identifying, analyzing, and mitigating risks to information systems and organizations.</div></div>
                                <div class="unified-card risk-framework-card" data-group="risk-framework"><span class="card-title">FAIR</span><div class="card-description">A quantitative risk analysis model that focuses on understanding and measuring information risk in financial terms. It helps break down complex risk scenarios into measurable components, enabling more objective risk comparisons and cost-benefit analyses.</div></div>
                                <div class="unified-card risk-framework-card" data-group="risk-framework"><span class="card-title">OCTAVE</span><div class="card-description">A suite of methods that help organizations assess and manage information security risks. It emphasizes a self-directed approach where organizations identify and prioritize risks based on their own operational risk environment, involving key stakeholders from across the organization.</div></div>
                            </div>
                            
                            <h4>d. Practical Risk Calculations</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="content-box">
                                    <h5 class="text-md font-bold text-white mb-2">Qualitative Risk Matrix</h5>
                                    <p class="text-gray-400 mb-4 text-sm">A risk matrix helps visualize and prioritize risks by plotting their likelihood against their potential impact.</p>
                                    <table class="dark-table w-full">
                                        <thead><tr><th>Likelihood \ Impact</th><th>Low</th><th>Medium</th><th>High</th></tr></thead>
                                        <tbody>
                                            <tr><td>High</td><td class="risk-level-medium">Medium</td><td class="risk-level-high">High</td><td class="critical">Critical</td></tr>
                                            <tr><td>Medium</td><td class="risk-level-low">Low</td><td class="risk-level-medium">Medium</td><td class="risk-level-high">High</td></tr>
                                            <tr><td>Low</td><td class="risk-level-low">Low</td><td class="risk-level-low">Low</td><td class="risk-level-medium">Medium</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="content-box calculator-form">
                                    <h5 class="text-md font-bold text-white mb-2">Quantitative Risk (ALE)</h5>
                                    <p class="text-gray-400 mb-4 text-sm">Calculate the Annualized Loss Expectancy (ALE).</p>
                                    <div class="mb-3">
                                        <label for="assetValue" class="block text-gray-400 text-sm font-bold mb-1">Asset Value (AV) ($):</label>
                                        <input type="text" id="assetValue" value="100,000" class="w-full">
                                    </div>
                                    <div class="mb-3">
                                        <label for="exposureFactor" class="block text-gray-400 text-sm font-bold mb-1">Exposure Factor (EF) (%):</label>
                                        <input type="number" id="exposureFactor" value="75" min="0" max="100" step="1" class="w-full">
                                    </div>
                                    <div class="mb-3">
                                        <label for="aro" class="block text-gray-400 text-sm font-bold mb-1">Annualized Rate of Occurrence (ARO):</label>
                                        <input type="number" id="aro" value="0.5" min="0" step="0.1" class="w-full">
                                    </div>
                                    <p class="text-gray-300 mt-4">SLE: $<span id="sleResult" class="calculator-result"></span></p>
                                    <p class="text-gray-300">ALE: $<span id="aleResult" class="calculator-result"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Information Security Risk Response Section -->
            <section id="risk-response" class="content-section hidden">
                <h2 class="text-3xl font-bold section-header mb-6">Section B: Information Security Risk Response</h2>
                <p class="mb-8 text-gray-400">Once risks have been assessed and analyzed, the next critical phase is to determine how to address them. This involves selecting and implementing appropriate risk treatment strategies.</p>
                
                <div class="space-y-4">
                    <!-- Risk Treatment / Risk Response Options -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>1. Risk Treatment / Risk Response Options</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                            <p>There are generally four primary strategies for responding to identified risks. Click on a card to learn about each strategy:</p>
                            <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card risk-response-card" data-group="risk-response"><span class="card-title">Mitigate</span><div class="card-description">Reduce the likelihood or impact of a risk through the implementation of security controls (e.g., firewalls, encryption, security awareness training). This is the most common response.</div></div>
                                <div class="unified-card risk-response-card" data-group="risk-response"><span class="card-title">Transfer</span><div class="card-description">Shift the financial or operational burden of a risk to a third party (e.g., purchasing cyber insurance, outsourcing to a vendor with strong security clauses).</div></div>
                                <div class="unified-card risk-response-card" data-group="risk-response"><span class="card-title">Avoid</span><div class="card-description">Eliminate the risk entirely by choosing not to engage in or ceasing an activity that gives rise to the risk (e.g., deciding not to store sensitive customer data, discontinuing an insecure legacy application).</div></div>
                                <div class="unified-card risk-response-card" data-group="risk-response"><span class="card-title">Accept</span><div class="card-description">Acknowledge the existence of a risk and decide to take no further action to mitigate it, usually because the cost of mitigation outweighs the potential impact, or the risk is below the organization's risk tolerance. Requires formal management approval.</div></div>
                            </div>
                            <h4>a. Inherent vs. Residual Risk</h4>
                             <div class="flex flex-wrap justify-center gap-4 my-6">
                                <div class="unified-card risk-method-card" data-group="risk-definitions-b1">
                                    <span class="card-title">Inherent Risk</span>
                                    <div class="card-description">The level of risk that exists before any security controls are applied.</div>
                                </div>
                                <div class="unified-card risk-method-card" data-group="risk-definitions-b1">
                                    <span class="card-title">Residual Risk</span>
                                    <div class="card-description">The level of risk that remains after security controls have been applied. The goal is to ensure the residual risk is at or below the organization's risk appetite.</div>
                                </div>
                            </div>
                            <h4>b. Ensure treatment aligns with legal, regulatory, and business constraints.</h4>
                            <p>Risk treatment decisions must comply with all applicable laws and regulations and support overall business objectives.</p>
                            <h4>c. Select controls using frameworks like ISO/IEC 27002 and NIST CSF.</h4>
                            <p>These frameworks provide a comprehensive set of generic information security controls and best practices for implementation.</p>
                        </div>
                    </div>

                    <!-- Risk and Control Ownership -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>2. Risk and Control Ownership</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                             <p>Clear accountability is essential for effective risk management.</p>
                             <h4>a. Assign risk ownership to appropriate stakeholders (e.g., data owners, business units).</h4>
                             <p>Risks belong to the business functions that generate or are most impacted by them, not solely to the security department.</p>
                             <h4>b. Establish accountability for control implementation and operation.</h4>
                             <p>Individuals or teams responsible for the implementation and maintenance of specific security controls must be clearly defined.</p>
                             <h4>c. Define responsibilities in risk treatment plans and governance documentation.</h4>
                             <p>Formal documentation like risk treatment plans and governance policies ensure that risk management is embedded into the organizational culture. Explore typical roles and their ownership responsibilities in the hierarchy below:</p>
                            <div class="content-box">
                                <h6 class="text-md font-semibold text-white mb-4 text-center">Corporate Hierarchy: Risk and Control Ownership</h6>
                                <div class="flex flex-col items-center gap-2">
                                    <div class="unified-card role-node" data-group="role-ownership">
                                        <span class="card-title">Board/Executive Management</span>
                                        <div class="card-description">The Board and Executive Management hold ultimate accountability for information security risk. Their responsibilities include defining the organization's overall risk appetite, approving major risk management strategies and significant security investments, and providing high-level oversight to ensure that information security aligns with business objectives and regulatory requirements. They ensure adequate resources are allocated for control implementation and monitor the overall effectiveness of the control environment.</div>
                                    </div>
                                    <div class="hierarchy-line"></div>
                                    <div class="unified-card role-node" data-group="role-ownership">
                                        <span class="card-title">CISO / Information Security Manager</span>
                                        <div class="card-description">Manages the security program, advises leadership on risk, oversees control implementation, and reports on the organization's risk posture.</div>
                                    </div>
                                    <div class="hierarchy-line-split"></div>
                                    <div class="flex justify-center gap-8 w-full mt-[-1rem] mb-[-1rem]">
                                        <div class="unified-card role-node" data-group="role-ownership">
                                            <span class="card-title">Data Owners / Business Unit Heads</span>
                                            <div class="card-description">Accountable for risks to specific data assets and business processes within their domains. They make risk treatment decisions (accept, mitigate, transfer) for their data and ensure appropriate controls are in place.</div>
                                        </div>
                                        <div class="unified-card role-node" data-group="role-ownership">
                                            <span class="card-title">IT Operations / Security Teams</span>
                                            <div class="card-description">Responsible for the technical implementation, operation, and maintenance of security controls as directed by management and security policies.</div>
                                        </div>
                                    </div>
                                    <div class="hierarchy-line"></div>
                                    <div class="unified-card role-node" data-group="role-ownership">
                                        <span class="card-title">End Users</span>
                                        <div class="card-description">Responsible for adhering to security policies and procedures in their daily activities, reporting suspicious events, and completing security awareness training.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Monitoring and Reporting -->
                    <div>
                        <button class="accordion-button w-full">
                            <span>3. Risk Monitoring and Reporting</span>
                            <span class="accordion-icon text-2xl">+</span>
                        </button>
                        <div class="accordion-content hidden">
                            <p>Risk management is not a one-time event; it's a continuous process that requires ongoing monitoring and communication.</p>
                            <h4>a. Monitor key risk indicators (KRIs), control effectiveness, and residual risk levels.</h4>
                            <p>Continuously track metrics that provide early warning signals of increasing risk exposure and assess the ongoing effectiveness of security controls.</p>
                            <div class="chart-container mb-6">
                                <canvas id="riskMonitoringKRIChart"></canvas>
                            </div>
                            <div class="mb-4">
                                <label for="riskMonitoringKRISelect" class="block text-gray-400 text-sm font-bold mb-2">Select KRI to view trend:</label>
                                <select id="riskMonitoringKRISelect" class="block w-full p-2 rounded-md" style="background-color: var(--dark-navy-bg); border: 1px solid var(--border-color);">
                                    <option value="unpatchedSystems">Unpatched Critical Systems</option>
                                    <option value="securityIncidents">Security Incidents Trend</option>
                                    <option value="thirdPartyBreaches">Third-Party Breach Incidents</option>
                                </select>
                            </div>
                            <h4>b. Report risk trends and posture to leadership.</h4>
                            <p>Tailor reports to the audience, providing high-level, strategic overviews for leadership to support informed decision-making. Below is a sample risk posture scorecard:</p>
                            <div class="content-box">
                                <h6 class="text-md font-semibold text-white mb-2 text-center">Sample Quarterly Risk Posture Scorecard</h6>
                                <table class="dark-table">
                                    <thead><tr><th>Risk Area</th><th>Current Level</th><th>Trend</th><th>Last Review</th></tr></thead>
                                    <tbody>
                                        <tr><td>Cyber Attack Surface</td><td class="risk-level-medium">Medium</td><td class="trend-stable">Stable</td><td>Q2 2025</td></tr>
                                        <tr><td>Data Privacy Compliance</td><td class="risk-level-low">Low</td><td class="trend-down">Improving</td><td>Q2 2025</td></tr>
                                        <tr><td>Third-Party Vendor Risk</td><td class="risk-level-high">High</td><td class="trend-up">Worsening</td><td>Q2 2025</td></tr>
                                        <tr><td>Insider Threat</td><td class="risk-level-medium">Medium</td><td class="trend-stable">Stable</td><td>Q2 2025</td></tr>
                                        <tr><td>Operational Resilience</td><td class="risk-level-low">Low</td><td class="trend-down">Improving</td><td>Q2 2025</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Key Terms Section -->
            <section id="key-terms" class="content-section hidden">
                <h2 class="text-3xl font-bold section-header mb-6">Key Terms</h2>
                <p class="mb-8 text-gray-400">Test your knowledge of key terms in Information Security Risk Management with these interactive flashcards. Click on a card to reveal its definition.</p>
                <div id="key-terms-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Key terms will be dynamically inserted here by JavaScript -->
                </div>
            </section>

            <!-- Domain Summary Section -->
            <section id="domain-summary" class="content-section hidden">
                <h2 class="text-3xl font-bold section-header mb-6">Domain Summary</h2>
                <div class="content-box">
                    <p>Domain 2: Information Security Risk Management is a critical component of the CISM framework, focusing on the systematic identification, assessment, response, and monitoring of risks to an organization's information assets. It emphasizes a proactive approach to understanding the evolving threat landscape, including emerging threats like ransomware, insider threats, and third-party risks, and analyzing their potential impact.</p>
                    <p>The domain covers various risk assessment methodologies, including qualitative, quantitative, and hybrid approaches, and the use of standardized frameworks such as ISO/IEC 27005, NIST SP 800-30, FAIR, and OCTAVE. It highlights the importance of distinguishing between inherent and residual risk and evaluating risks based on their likelihood and business impact. Furthermore, Domain 2 delves into risk response strategies—mitigating with controls, transferring through contracts or insurance, avoiding risky activities, or accepting risks with management approval—ensuring these align with legal, regulatory, and business constraints.</p>
                    <p>Crucially, this domain stresses the assignment of clear risk and control ownership to appropriate stakeholders, establishing accountability for implementation and operation. Finally, it covers the continuous process of risk monitoring and reporting, including maintaining risk registers, tracking Key Risk Indicators (KRIs), and communicating risk posture to leadership through dashboards and executive summaries, all aimed at supporting continuous improvement in the organization's security posture.</p>
                </div>
            </section>
        </main>

        <footer class="text-center py-8 mt-10 text-gray-500 text-sm">
            <p>&copy; 2025 CISM Study Guide. All rights reserved. For educational purposes only.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIG & DATA ---
            const textPrimary = '#e2e8f0';
            const textSecondary = '#94a3b8';
            const borderColor = '#2d3748';
            const surfaceColor = '#10192b';
            const chartColors = {
                red: '#FF6384',
                yellow: '#FFCD56',
                green: '#4BC0C0',
                purple: '#9966FF',
                orange: '#DAA520',
                blue_alt: '#6A5ACD',
                cyan: '#00bfff' // Accent Glow
            };

            const threatDistributionData = {
                threatOrder: ['Ransomware', 'Insider Threats', 'Third-Party Risks', 'Phishing', 'DDoS', 'APT'],
                threatColors: [chartColors.red, chartColors.yellow, chartColors.purple, chartColors.green, chartColors.blue_alt, chartColors.orange],
                ransomwareFocus: { data: [40, 10, 15, 15, 10, 10], explanation: `Focus on Ransomware (40%). This is malicious software that encrypts data and demands a ransom for its release.` },
                insiderFocus: { data: [10, 40, 15, 15, 10, 10], explanation: `Focus on Insider Threats (40%). These threats originate from within the organization and can be malicious or unintentional.` },
                thirdPartyFocus: { data: [15, 10, 40, 15, 10, 10], explanation: `Focus on Third-Party Risks (40%). These risks arise from reliance on external vendors and service providers.` },
                phishingFocus: { data: [15, 10, 10, 40, 10, 15], explanation: `Focus on Phishing (40%). A common social engineering technique to trick individuals into revealing sensitive info.` },
                ddosFocus: { data: [10, 10, 15, 15, 40, 10], explanation: `Focus on DDoS (40%). Attacks that overwhelm a system with traffic, making it unavailable.` },
                aptFocus: { data: [10, 10, 15, 15, 10, 40], explanation: `Focus on APTs (40%). Sophisticated, prolonged cyberattacks where an intruder remains undetected.` }
            };

            const riskMonitoringKRITrendData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                unpatchedSystems: { label: 'Unpatched Critical Systems', data: [15, 12, 10, 8, 7, 6, 5, 4, 3, 2, 1, 1], borderColor: chartColors.red, backgroundColor: 'rgba(255, 99, 132, 0.2)' },
                securityIncidents: { label: 'Security Incidents Reported', data: [5, 7, 6, 8, 9, 7, 6, 5, 4, 3, 2, 2], borderColor: chartColors.cyan, backgroundColor: 'rgba(0, 191, 255, 0.2)' },
                thirdPartyBreaches: { label: 'Third-Party Breach Incidents', data: [2, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0], borderColor: chartColors.yellow, backgroundColor: 'rgba(255, 205, 86, 0.2)' }
            };
            
            const keyTermsData = [
                 { term: "Risk", definition: "The potential for loss, calculated as the product of likelihood and impact." },
                 { term: "Threat", definition: "Any potential danger that could harm an asset." },
                 { term: "Vulnerability", definition: "A weakness in an asset or control that can be exploited by a threat." },
                 { term: "Risk Assessment", definition: "The overall process of identifying, analyzing, and evaluating risks." },
                 { term: "Risk Analysis", definition: "The specific step of evaluating the likelihood and impact of a risk." },
                 { term: "Qualitative Risk Analysis", definition: "A subjective analysis using descriptive terms (High, Medium, Low)." },
                 { term: "Quantitative Risk Analysis", definition: "An objective analysis using monetary values (SLE, ARO, ALE)." },
                 { term: "SLE (Single Loss Expectancy)", definition: "The financial loss from a single incident." },
                 { term: "ARO (Annualized Rate of Occurrence)", definition: "The number of times an incident is expected to occur in one year." },
                 { term: "ALE (Annualized Loss Expectancy)", definition: "The total expected financial loss from a risk in one year." },
                 { term: "Risk Mitigation", definition: "Applying controls to reduce risk." },
                 { term: "Risk Transference", definition: "Shifting the financial impact of a risk to a third party (e.g., insurance)." },
                 { term: "Risk Avoidance", definition: "Not engaging in the activity that creates the risk." },
                 { term: "Risk Acceptance", definition: "Formally deciding to accept a risk without further action." },
                 { term: "Inherent Risk", definition: "The risk before controls are applied." },
                 { term: "Residual Risk", definition: "The risk that remains after controls are applied." },
                 { term: "KRI (Key Risk Indicator)", definition: "A forward-looking metric used as an early warning for changing risk levels." },
                 { term: "Risk Register", definition: "A document used to track and manage all identified risks." },
                 { term: "Risk Appetite", definition: "The amount of risk an organization is willing to take to achieve its objectives. It's a high-level strategic statement." },
                 { term: "Risk Tolerance", definition: "The acceptable deviation from the risk appetite. It sets specific thresholds for different types of risks." }
            ];

            let threatDistributionChartInstance, riskMonitoringKRIChartInstance;

            // --- BEHAVIOR SETUP ---
            function setupNavigation() {
                document.querySelectorAll('.nav-item').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        document.querySelectorAll('.content-section').forEach(section => section.classList.add('hidden'));
                        const targetSection = document.getElementById(button.dataset.target);
                        targetSection.classList.remove('hidden');
                        // Use a short timeout to ensure the fade-in animation triggers correctly
                        setTimeout(() => targetSection.classList.add('fade-in'), 10);
                    });
                });
            }

            function setupAccordions() {
                document.querySelectorAll('.accordion-button').forEach(button => {
                    button.addEventListener('click', () => {
                        const content = button.nextElementSibling;
                        const icon = button.querySelector('.accordion-icon');
                        const isOpening = content.classList.contains('hidden');
                        
                        if (isOpening) {
                            content.classList.remove('hidden');
                            button.classList.add('open');
                            icon.textContent = '-';
                        } else {
                            content.classList.add('hidden');
                            button.classList.remove('open');
                            icon.textContent = '+';
                        }
                    });
                });
            }
            
            /**
             * Sets up card toggle functionality using event delegation.
             * This is more efficient and robust, especially for dynamically added content.
             */
            function setupCardTogglesWithDelegation() {
                const contentArea = document.getElementById('content-area');
                if (!contentArea) return;

                contentArea.addEventListener('click', (e) => {
                    // Find the closest card with a data-group attribute from the click target
                    const card = e.target.closest('[data-group]');
                    
                    // If no card was clicked, do nothing
                    if (!card) return;

                    // This logic handles all cards with a 'data-group' attribute
                    const group = card.dataset.group;
                    const isAlreadyActive = card.classList.contains('active');

                    // Deactivate all cards in the same group
                    contentArea.querySelectorAll(`[data-group="${group}"]`).forEach(otherCard => {
                        otherCard.classList.remove('active');
                    });

                    // If the card was not already active, activate it.
                    // This creates a toggle behavior: click once to open, click again (or another card) to close.
                    if (!isAlreadyActive) {
                        card.classList.add('active');
                    }
                });
            }

            function setupFlowchartToggles() {
                document.querySelectorAll('.flow-scenario').forEach(scenario => {
                    const vulnerabilityNode = scenario.querySelector('[data-node-type="vulnerability"]');
                    const threatNode = scenario.querySelector('[data-node-type="threat"]');
                    const impactNode = scenario.querySelector('[data-node-type="impact"]');
                    const arrows = scenario.querySelectorAll('.flow-arrow');

                    vulnerabilityNode.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isAlreadyActive = vulnerabilityNode.classList.contains('active');
                        
                        // Reset all other scenarios to ensure only one is open at a time
                        document.querySelectorAll('.flow-scenario').forEach(s => {
                            if (s !== scenario) {
                                s.querySelectorAll('.unified-card').forEach(n => n.classList.remove('active'));
                                s.querySelectorAll('.flow-arrow, [data-node-type="threat"], [data-node-type="impact"]').forEach(el => el.classList.add('hidden'));
                            }
                        });

                        // Toggle the current scenario's first step
                        if (!isAlreadyActive) {
                            vulnerabilityNode.classList.add('active');
                            threatNode.classList.remove('hidden');
                            arrows[0].classList.remove('hidden');
                        } else {
                             // If clicking an active vulnerability node, close the whole chain
                            vulnerabilityNode.classList.remove('active');
                            threatNode.classList.add('hidden');
                            threatNode.classList.remove('active');
                            impactNode.classList.add('hidden');
                            impactNode.classList.remove('active');
                            arrows.forEach(arrow => arrow.classList.add('hidden'));
                        }
                    });

                    threatNode.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isAlreadyActive = threatNode.classList.contains('active');

                        // Toggle the second step
                        if (!isAlreadyActive) {
                            threatNode.classList.add('active');
                            impactNode.classList.remove('hidden');
                            arrows[1].classList.remove('hidden');
                        } else {
                            threatNode.classList.remove('active');
                            impactNode.classList.add('hidden');
                            impactNode.classList.remove('active'); // also deactivate impact
                            arrows[1].classList.add('hidden');
                        }
                    });

                     impactNode.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // Simple toggle for the final card in the chain
                        impactNode.classList.toggle('active');
                    });
                });
            }

            // --- CHART & INTERACTIVE LOGIC ---
            function initThreatDistributionChart() {
                const ctx = document.getElementById('threatDistributionChart')?.getContext('2d');
                if (!ctx) return;
                threatDistributionChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: threatDistributionData.threatOrder,
                        datasets: [{
                            data: threatDistributionData.ransomwareFocus.data, // Default view
                            backgroundColor: threatDistributionData.threatColors,
                            hoverOffset: 4,
                            borderColor: surfaceColor
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: textSecondary } } } }
                });

                document.querySelectorAll('.toggle-chart-data[data-chart-id="threatDistributionChart"]').forEach(button => {
                    button.addEventListener('click', e => {
                        const dataSetKey = e.currentTarget.dataset.dataSet;
                        const data = threatDistributionData[dataSetKey];
                        threatDistributionChartInstance.data.datasets[0].data = data.data;
                        threatDistributionChartInstance.update();
                        document.getElementById('threat-explanation').textContent = data.explanation;
                    });
                });
                 // Set initial explanation
                document.getElementById('threat-explanation').textContent = threatDistributionData.ransomwareFocus.explanation;
            }

            function initRiskMonitoringKRIChart() {
                const ctx = document.getElementById('riskMonitoringKRIChart')?.getContext('2d');
                if (!ctx) return;
                riskMonitoringKRIChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: riskMonitoringKRITrendData.labels,
                        datasets: [{ ...riskMonitoringKRITrendData.unpatchedSystems, fill: true, tension: 0.3 }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, grid: { color: borderColor }, ticks: { color: textSecondary } },
                            x: { grid: { color: borderColor }, ticks: { color: textSecondary } }
                        },
                        plugins: { legend: { position: 'top', labels: { color: textSecondary } } }
                    }
                });
                document.getElementById('riskMonitoringKRISelect').addEventListener('change', e => {
                    const data = riskMonitoringKRITrendData[e.target.value];
                    riskMonitoringKRIChartInstance.data.datasets[0] = { ...data, fill: true, tension: 0.3 };
                    riskMonitoringKRIChartInstance.update();
                });
            }

            function setupALE_Calculator() {
                const inputs = ['assetValue', 'exposureFactor', 'aro'];
                inputs.forEach(id => document.getElementById(id)?.addEventListener('input', calculateQuantitativeRisk));
                calculateQuantitativeRisk(); // Initial calculation
            }

            function calculateQuantitativeRisk() {
                const assetValueInput = document.getElementById('assetValue');
                if (!assetValueInput) return;
                
                const rawAssetValue = assetValueInput.value.replace(/,/g, '');
                let assetValue = parseFloat(rawAssetValue);
                const exposureFactor = parseFloat(document.getElementById('exposureFactor').value) / 100; // Convert percentage to decimal
                const aro = parseFloat(document.getElementById('aro').value);

                if (!isNaN(assetValue)) {
                    assetValueInput.value = assetValue.toLocaleString('en-US');
                } else {
                    assetValue = 0;
                }

                let sle = 0;
                let ale = 0;

                if (!isNaN(assetValue) && !isNaN(exposureFactor)) {
                    sle = assetValue * exposureFactor;
                }
                if (!isNaN(sle) && !isNaN(aro)) {
                    ale = sle * aro;
                }

                document.getElementById('sleResult').textContent = sle.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                document.getElementById('aleResult').textContent = ale.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }

            function renderKeyTerms() {
                const container = document.getElementById('key-terms-grid');
                if (!container) return;
                container.innerHTML = '';
                keyTermsData.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'unified-card key-term-card';
                    card.dataset.group = 'key-terms'; // This allows the delegated event listener to find it
                    card.innerHTML = `
                        <span class="card-title">${item.term}</span>
                        <div class="card-description">${item.definition}</div>
                    `;
                    container.appendChild(card);
                });
            }

            // --- INITIALIZATION ---
            setupNavigation();
            setupAccordions();
            setupCardTogglesWithDelegation(); // Use the new, robust method
            setupFlowchartToggles();
            initThreatDistributionChart();
            initRiskMonitoringKRIChart();
            setupALE_Calculator();
            renderKeyTerms();
        });
    </script>
</body>
</html>
