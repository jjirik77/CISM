<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISM 2024: Assessment Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5EF; /* Warm Neutral Background */
            color: #333333;
        }
        .container {
            max-width: 1200px;
        }
        .section-header {
            border-left: 6px solid #00A896; /* Vibrant Teal Accent */
            padding-left: 1.25rem;
            font-size: 2.5rem;
            color: #222222;
        }
        .nav-item.active {
            border-bottom: 3px solid #00A896;
            font-weight: 700;
            color: #222222;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .assessment-tab.active {
            background-color: #00A896;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .assessment-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .assessment-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #00A896;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #008778;
        }
        .btn-danger {
            background-color: #DC3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-secondary {
            background-color: #EDEAE0;
            color: #333333;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #D5D2C8;
        }
        .answer-option {
            border: 2px solid #EDEAE0;
            border-radius: 0.5rem;
            padding: 1rem;
            cursor: pointer;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .answer-option:hover {
            border-color: #00A896;
        }
        .answer-option.selected {
            background-color: #E0F7F5;
            border-color: #00A896;
        }
        .answer-option.correct {
            background-color: #D4EDDA;
            border-color: #155724;
        }
        .answer-option.incorrect {
            background-color: #F8D7DA;
            border-color: #721C24;
        }
        .progress-bar-container {
            background-color: #EDEAE0;
            border-radius: 9999px;
            height: 10px;
            width: 100%;
            overflow: hidden;
        }
        .progress-bar {
            background-color: #00A896;
            height: 100%;
            transition: width 0.3s ease-in-out;
        }
        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
    </style>
</head>
<body class="leading-relaxed">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center py-8 bg-white rounded-lg shadow-md mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-2">CISM Assessment Center</h1>
            <p class="text-xl sm:text-2xl text-gray-600">Test Your Knowledge and Prepare for the Exam</p>
        </header>

        <!-- Main Content Area -->
        <main id="assessment-container">
            <!-- Assessment Setup View -->
            <div id="assessment-setup">
                <nav class="bg-white p-4 rounded-lg shadow-md mb-8 flex flex-wrap justify-center sticky top-0 z-10">
                    <button class="assessment-tab px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200 active" data-target="domain-1">Domain 1</button>
                    <button class="assessment-tab px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="domain-2">Domain 2</button>
                    <button class="assessment-tab px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="domain-3">Domain 3</button>
                    <button class="assessment-tab px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="domain-4">Domain 4</button>
                    <button class="assessment-tab px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="simulated-exam">Simulated Exam</button>
                </nav>

                <div id="assessment-options-area" class="fade-in">
                    <!-- Domain-specific options will be injected here -->
                </div>
            </div>

            <!-- Assessment In-Progress View -->
            <div id="assessment-in-progress" class="hidden">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="question-counter" class="text-xl font-bold text-gray-800">Question 1 of 10</h2>
                        <div id="timer-display" class="text-xl font-bold text-gray-800 hidden">4:00:00</div>
                        <button id="quit-assessment-btn" class="btn-secondary text-sm px-3 py-1">Quit</button>
                    </div>
                    <div class="progress-bar-container mb-6">
                        <div id="progress-bar" class="progress-bar" style="width: 10%;"></div>
                    </div>
                    <p id="question-text" class="text-lg text-gray-700 mb-6">This is where the question text will appear. It might be a long question to test how the layout handles multiple lines of text.</p>
                    <div id="answer-options" class="space-y-4">
                        <!-- Answer options will be injected here -->
                    </div>
                    <div class="flex justify-between mt-8">
                        <button id="prev-question-btn" class="btn-secondary">Previous</button>
                        <button id="next-question-btn" class="btn-primary">Next</button>
                        <button id="submit-assessment-btn" class="btn-primary hidden">Submit</button>
                    </div>
                </div>
            </div>

            <!-- Assessment Results View -->
            <div id="assessment-results" class="hidden">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md text-center">
                    <h2 class="text-3xl font-bold section-header text-gray-800 mb-4 inline-block">Assessment Complete!</h2>
                    <p class="text-xl text-gray-600 mb-2">Here's how you did:</p>
                    <p id="final-score" class="text-6xl font-extrabold text-gray-800 my-4">85%</p>
                    <p id="score-details" class="text-lg text-gray-700 mb-6">You answered 17 out of 20 questions correctly.</p>
                    <div id="results-breakdown" class="mb-8 text-left max-w-md mx-auto">
                        <!-- Results breakdown will be injected here -->
                    </div>
                    <div class="flex justify-center gap-4">
                        <button id="review-answers-btn" class="btn-secondary">Review Answers</button>
                        <button id="restart-assessment-btn" class="btn-primary">Try Again</button>
                    </div>
                </div>
            </div>
            
            <!-- Assessment Review View -->
            <div id="assessment-review" class="hidden">
                 <!-- Review content will be dynamically generated here -->
            </div>
        </main>

        <footer class="text-center py-6 mt-8 text-gray-500 text-sm">
            <p>&copy; 2024 CISM Study Guide. All rights reserved. For educational purposes only.</p>
        </footer>
    </div>

    <!-- Quit Confirmation Modal -->
    <div id="quit-modal" class="modal-overlay hidden">
        <div class="modal-content fade-in">
            <h3 class="text-xl font-bold mb-4">Are you sure?</h3>
            <p class="text-gray-600 mb-6">Your progress on this assessment will be lost.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-quit-btn" class="btn-secondary">Cancel</button>
                <button id="confirm-quit-btn" class="btn-primary btn-danger">Yes, Quit</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        const questionBank = {
            'domain-1': [
                { question: "What is the primary goal of information security governance?", answers: ["To reduce the cost of security controls", "To ensure that security strategies are aligned with business objectives", "To implement the latest security technologies", "To achieve 100% compliance with all regulations"], correct: 1, explanation: "The primary goal of information security governance is to align security efforts with the strategic goals of the business, ensuring that security is an enabler, not a hindrance." },
                { question: "Which of the following is a key outcome of a mature security governance framework?", answers: ["Increased IT budget", "Risk optimization", "Elimination of all security incidents", "Shorter product development cycles"], correct: 1, explanation: "A mature governance framework enables the organization to make informed decisions to optimize risk, balancing the cost of controls with the potential impact of threats to achieve business objectives." },
                { question: "Who is ultimately responsible for information security within an organization?", answers: ["The CISO", "The IT department", "The Board of Directors / Senior Management", "All employees"], correct: 2, explanation: "While the CISO manages the program and employees have a role, the ultimate responsibility and accountability for information security lie with the highest levels of leadership, such as the Board of Directors and senior management." },
                { question: "A strategic alignment of security with business objectives is BEST achieved through:", answers: ["Implementing a SIEM", "Developing a comprehensive information security governance framework", "Hiring more security analysts", "Conducting annual penetration tests"], correct: 1, explanation: "A governance framework provides the structure, policies, and processes to ensure that security activities directly support and align with the broader goals of the business." },
                { question: "What is the MOST important objective of creating a business case for a security investment?", answers: ["To guarantee the project gets approved", "To demonstrate the ROI and value to the business", "To list all technical features of a proposed solution", "To satisfy an audit requirement"], correct: 1, explanation: "The primary purpose of a business case is to articulate the value proposition in business terms, often by showing a positive Return on Investment (ROI) or other quantifiable benefits, to secure funding and support from management." },
                { question: "Which of the following is an example of a detective control?", answers: ["Firewall", "Encryption", "Security awareness training", "Log file monitoring"], correct: 3, explanation: "Detective controls are designed to identify and report that an incident has occurred. Log file monitoring actively searches for signs of intrusion or policy violations after they have happened." },
                { question: "The process of identifying, classifying, and prioritizing information assets is a foundational step for:", answers: ["Network segmentation", "Effective risk management", "Choosing an antivirus vendor", "Writing a press release"], correct: 1, explanation: "An organization cannot effectively protect what it does not know it has. Identifying and understanding the value of its information assets is the first step in applying appropriate risk management and protection." },
                { question: "An organization's risk appetite is BEST defined as:", answers: ["The amount of loss experienced in a year", "The budget allocated for security controls", "The amount of risk the organization is willing to accept to achieve its objectives", "The number of open vulnerabilities on a scan report"], correct: 2, explanation: "Risk appetite is a high-level, strategic statement from senior management that defines the level of risk the organization is willing to pursue or tolerate in its activities." },
                { question: "Which role is responsible for classifying data and determining appropriate access controls?", answers: ["Data custodian", "Data user", "Data owner", "Data processor"], correct: 2, explanation: "The data owner, typically a senior business manager, is accountable for the data and is responsible for making key decisions about its classification and protection, including who is authorized to access it." },
                { question: "The PRIMARY benefit of a well-defined information security architecture is:", answers: ["It allows for faster software development", "It reduces the need for user training", "It ensures consistent and cost-effective implementation of security controls", "It guarantees compliance with all international laws"], correct: 2, explanation: "A security architecture provides a blueprint for how controls are designed and integrated, which leads to consistency, avoids redundant or conflicting controls, and ensures that security is implemented in a cost-effective manner that aligns with the overall strategy." },
            ],
            'domain-2': [
                { question: "What is the formula for calculating Annualized Loss Expectancy (ALE)?", answers: ["SLE / ARO", "AV * EF", "SLE * ARO", "AV - SLE"], correct: 2, explanation: "ALE is calculated by multiplying the Single Loss Expectancy (SLE) by the Annualized Rate of Occurrence (ARO). It represents the expected monetary loss for an asset over a one-year period." },
                { question: "Which risk response strategy involves purchasing cybersecurity insurance?", answers: ["Mitigation", "Avoidance", "Acceptance", "Transfer"], correct: 3, explanation: "Purchasing insurance is a form of risk transfer, where the financial impact of a potential security incident is shifted to a third party (the insurance company)." },
                { question: "A risk assessment identifies a vulnerability with a high impact but a very low likelihood. What is this an example of?", answers: ["Inherent risk", "Residual risk", "A risk that should always be avoided", "A candidate for risk acceptance"], correct: 0, explanation: "Inherent risk is the risk level before any controls are applied. The initial assessment of impact and likelihood defines the inherent risk." },
                { question: "The main purpose of a threat assessment is to:", answers: ["Identify all vulnerabilities in a system", "Determine the effectiveness of existing controls", "Identify and evaluate potential adversaries and their methods", "Calculate the Annualized Loss Expectancy (ALE)"], correct: 2, explanation: "A threat assessment focuses specifically on identifying the sources of threats (e.g., hackers, insiders, nature) and the methods they might use to cause harm to the organization's assets." },
                { question: "In a quantitative risk analysis, what does the Exposure Factor (EF) represent?", answers: ["The number of times an event is expected to occur in a year", "The total value of the asset", "The percentage of loss a realized threat would have on an asset", "The cost of the security control to be implemented"], correct: 2, explanation: "The Exposure Factor (EF) is a measure of the potential damage from a specific threat, expressed as a percentage of the asset's value. For example, if a fire would destroy 50% of a data center, the EF is 50%." },
                { question: "What is residual risk?", answers: ["The risk before any controls are applied", "The risk that is transferred to another party", "The risk that remains after management has implemented controls", "The risk that has been identified but not yet assessed"], correct: 2, explanation: "Residual risk is the level of risk that is left over after security controls and other mitigation strategies have been applied. It's the risk that the organization accepts as a cost of doing business." },
                { question: "Which of the following is the BEST reason for a company to formally accept a risk?", answers: ["The security team does not know how to fix it", "The cost of mitigating the risk is greater than the potential impact", "The risk was identified by a junior analyst", "Management is not concerned about security"], correct: 1, explanation: "Risk acceptance is a valid business decision when the cost of the countermeasure (the control) is more expensive than the potential loss from the risk itself. It must be a formal, documented decision by management." },
                { question: "A key benefit of using a standardized risk management framework like NIST SP 800-30 is that it:", answers: ["Guarantees the organization will not have a security breach", "Provides a structured and repeatable process for assessing risk", "Eliminates the need for security expertise", "Is the only framework accepted by auditors"], correct: 1, explanation: "Standardized frameworks provide a consistent methodology and vocabulary for risk management, which makes the process structured, repeatable, and easier to communicate across the organization." },
                { question: "The difference between a vulnerability and a threat is that:", answers: ["A threat is a weakness, and a vulnerability is the actor that exploits it", "A vulnerability is a weakness, and a threat is the actor or event that could exploit it", "They are the same thing", "A vulnerability is caused by a threat"], correct: 1, explanation: "A vulnerability is an internal weakness or flaw in a system or process. A threat is an external entity or event (like a hacker or a natural disaster) that has the potential to exploit that vulnerability." },
                { question: "When developing risk scenarios, the MOST important factor to consider is:", answers: ["The technical complexity of the attack", "The likelihood of a zero-day exploit being used", "The potential business impact", "The cost of the asset being targeted"], correct: 2, explanation: "While all factors are relevant, risk management is primarily concerned with protecting the business. Therefore, understanding the potential business impact of a risk scenario is the most critical factor for prioritization and decision-making." },
            ],
            'domain-3': [
                { question: "What is the primary purpose of a Security Operations Center (SOC)?", answers: ["To develop security policies", "To conduct security awareness training", "To monitor, detect, analyze, and respond to cybersecurity incidents", "To manage the security budget"], correct: 2, explanation: "A SOC is a centralized unit that deals with security issues on an organizational and technical level, focusing on the real-time monitoring and handling of security incidents." },
                { question: "Which of the following is a key component of an Incident Response Plan (IRP)?", answers: ["A list of all company assets", "The marketing department's contact list", "Communication protocols for stakeholders", "The company's mission statement"], correct: 2, explanation: "A critical part of any IRP is defining clear communication protocols to ensure that all relevant stakeholders (internal and external) are informed appropriately during an incident." },
                { question: "The main goal of a security awareness program is to:", answers: ["Ensure everyone in IT is a security expert", "Fulfill a compliance requirement", "Influence user behavior to reduce security risk", "Teach users how to write secure code"], correct: 2, explanation: "While compliance is a benefit, the primary goal is to change how users think about and act on security, making them a strong first line of defense and reducing human-related risks like falling for phishing scams." },
                { question: "Which of the following is the BEST metric to measure the effectiveness of a security awareness program?", answers: ["The number of people who completed the training", "The cost of the training program", "A reduction in the number of user-reported security incidents", "Positive feedback from employees about the training"], correct: 2, explanation: "The ultimate goal is behavior change that reduces risk. A decrease in successful phishing attacks or an increase in users correctly reporting suspicious emails is a direct measure of the program's impact on reducing risk." },
                { question: "What is the primary purpose of patch management?", answers: ["To add new features to software", "To reduce the attack surface by remediating known vulnerabilities", "To ensure all software is from the same vendor", "To monitor system performance"], correct: 1, explanation: "Patch management is a critical security process focused on identifying, testing, and deploying software updates (patches) to fix vulnerabilities that could otherwise be exploited by attackers." },
                { question: "In the context of identity and access management, the principle of 'least privilege' means:", answers: ["All users should have administrator rights", "Users should only be granted the minimum level of access necessary to perform their job functions", "Access should be granted based on seniority", "Users can choose their own access rights"], correct: 1, explanation: "Least privilege is a foundational security principle that limits user access rights to the bare minimum permissions they need to do their job. This minimizes the damage that can be done if an account is compromised." },
                { question: "What is the function of a Security Information and Event Management (SIEM) system?", answers: ["To automatically block all incoming network traffic", "To manage user passwords and access credentials", "To aggregate and analyze log data from multiple sources to identify security threats", "To encrypt all data on the network"], correct: 2, explanation: "A SIEM system is a powerful tool that collects security-related data from across the IT environment (e.g., firewalls, servers, applications) and uses correlation and analysis to detect potential threats and facilitate incident response." },
                { question: "When an organization outsources a service to a third-party vendor, who is ultimately accountable for the security of the data?", answers: ["The third-party vendor", "The organization", "The cloud provider", "The end users"], correct: 1, explanation: "An organization can delegate responsibility for security tasks, but it cannot outsource accountability. The organization that owns the data is always ultimately accountable for its protection, regardless of where it is stored or processed." },
                { question: "The purpose of performing a gap analysis against a security framework like ISO 27001 is to:", answers: ["Identify all potential threats to the organization", "Determine the difference between the current state of security controls and the framework's requirements", "Calculate the ROI of the security program", "Choose which vendor to purchase security tools from"], correct: 1, explanation: "A gap analysis is a formal review that compares an organization's existing security posture and controls against the requirements of a specific framework or standard to identify areas that are missing or need improvement." },
                { question: "Which of the following is the MOST secure method for multi-factor authentication (MFA)?", answers: ["Email-based one-time password", "SMS-based one-time password", "A push notification to a mobile app", "A FIDO2-compliant hardware security key"], correct: 3, explanation: "Hardware security keys (like a YubiKey) are considered the gold standard for MFA because they are resistant to phishing and man-in-the-middle attacks, unlike SMS or email, which can be intercepted." },
            ],
            'domain-4': [
                { question: "In the context of Business Continuity Planning (BCP), what does Recovery Time Objective (RTO) define?", answers: ["The amount of data that can be lost", "The time it takes to write the BCP plan", "The target time within which a business process must be restored after a disaster", "The time it takes to detect an incident"], correct: 2, explanation: "RTO is a critical metric in BCP that defines the maximum acceptable downtime for a business process before significant negative impacts occur." },
                { question: "What is the main difference between a Business Continuity Plan (BCP) and a Disaster Recovery (DR) Plan?", answers: ["BCP is for natural disasters only, DR is for cyber attacks", "BCP focuses on keeping business processes running, while DR focuses on restoring IT infrastructure", "There is no difference", "BCP is managed by the business, DR is managed by the government"], correct: 1, explanation: "BCP has a broader scope, focusing on the continuity of critical business functions. DR is a subset of BCP, specifically focused on the technical recovery of IT systems and infrastructure." },
                { question: "What is the FIRST step in the incident response process?", answers: ["Eradication", "Containment", "Preparation", "Recovery"], correct: 2, explanation: "The incident response lifecycle begins with Preparation. This phase involves creating plans, training the team, and having the necessary tools in place before an incident ever occurs." },
                { question: "The Recovery Point Objective (RPO) is concerned with:", answers: ["The time it takes to recover a system", "The acceptable amount of data loss", "The number of people on the recovery team", "The location of the alternate site"], correct: 1, explanation: "RPO defines the maximum tolerable amount of data that can be lost from an IT service due to a major incident. It essentially determines the frequency of backups (e.g., an RPO of 1 hour requires hourly backups)." },
                { question: "During which phase of incident response would an analyst take an infected server offline?", answers: ["Detection and Analysis", "Containment", "Post-Incident Activity", "Preparation"], correct: 1, explanation: "Containment is the phase focused on stopping the spread of an incident and preventing further damage. Taking an infected server offline is a key containment strategy to isolate the threat." },
                { question: "The primary purpose of a Business Impact Analysis (BIA) is to:", answers: ["Identify and prioritize critical business functions and their dependencies", "Select a vendor for an alternate recovery site", "Document the steps to recover a specific server", "Test the incident response plan"], correct: 0, explanation: "The BIA is the foundation of business continuity planning. Its purpose is to identify the organization's most critical processes and the resources they depend on, which allows for the prioritization of recovery efforts." },
                { question: "What is a 'hot site' in the context of disaster recovery?", answers: ["A recovery site that is still under construction", "A fully equipped and configured data center that can be operational in minutes or hours", "An empty data center with power and cooling but no hardware", "A temporary office space for employees with no IT equipment"], correct: 1, explanation: "A hot site is the most expensive but fastest type of recovery site. It is a near-duplicate of the primary site with all necessary hardware, software, and network connectivity, ready to take over at a moment's notice." },
                { question: "After a security incident has been resolved, what is the MOST important activity to perform?", answers: ["Blame the responsible party", "Delete all logs related to the incident", "Conduct a lessons-learned review", "Immediately purchase a new security tool"], correct: 2, explanation: "The post-incident activity, or lessons-learned phase, is crucial for continuous improvement. It involves analyzing what happened, what worked, what didn't, and how the incident response process can be improved for the future." },
                { question: "Which of the following is the BEST way to test the effectiveness of a Disaster Recovery Plan?", answers: ["A tabletop exercise where the team discusses the plan", "A full-scale simulation that includes a failover to the alternate site", "A checklist review of the plan's contents", "Sending the plan to an auditor for review"], correct: 1, explanation: "While all are valid testing methods, a full-scale simulation provides the most realistic and comprehensive test of the DR plan's effectiveness, as it actually performs the recovery procedures and validates the capabilities of the alternate site." },
                { question: "The concept of 'chain of custody' is most critical when dealing with:", answers: ["Employee training records", "Financial reports", "Evidence handling during a forensic investigation", "Vendor contracts"], correct: 2, explanation: "Chain of custody is a formal, documented process that shows the chronological history of how evidence was collected, handled, transferred, and stored. Maintaining this chain is essential to ensure the integrity of the evidence and its admissibility in legal proceedings." },
            ],
        };

        const domainWeights = {
            'domain-1': 0.17, // 17%
            'domain-2': 0.20, // 20%
            'domain-3': 0.33, // 33%
            'domain-4': 0.30, // 30%
        };

        const domainDetails = {
            'domain-1': { title: "Domain 1: Information Security Governance", weight: 17 },
            'domain-2': { title: "Domain 2: Information Security Risk Management", weight: 20 },
            'domain-3': { title: "Domain 3: Information Security Program", weight: 33 },
            'domain-4': { title: "Domain 4: Incident Management", weight: 30 },
            'simulated-exam': { title: "Simulated Exam", totalQuestions: 150 }
        };

        // --- STATE ---
        let currentAssessment = {
            questions: [],
            userAnswers: [],
            currentQuestionIndex: 0,
            startTime: null,
            assessmentType: null,
            timerInterval: null,
        };

        // --- DOM ELEMENTS ---
        const setupView = document.getElementById('assessment-setup');
        const inProgressView = document.getElementById('assessment-in-progress');
        const resultsView = document.getElementById('assessment-results');
        const reviewView = document.getElementById('assessment-review');
        const optionsArea = document.getElementById('assessment-options-area');
        const tabs = document.querySelectorAll('.assessment-tab');
        
        const questionCounter = document.getElementById('question-counter');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const answerOptionsContainer = document.getElementById('answer-options');
        const prevBtn = document.getElementById('prev-question-btn');
        const nextBtn = document.getElementById('next-question-btn');
        const submitBtn = document.getElementById('submit-assessment-btn');
        const quitBtn = document.getElementById('quit-assessment-btn');
        const timerDisplay = document.getElementById('timer-display');

        const finalScoreEl = document.getElementById('final-score');
        const scoreDetailsEl = document.getElementById('score-details');
        const resultsBreakdownEl = document.getElementById('results-breakdown');
        const reviewAnswersBtn = document.getElementById('review-answers-btn');
        const restartAssessmentBtn = document.getElementById('restart-assessment-btn');

        const quitModal = document.getElementById('quit-modal');
        const confirmQuitBtn = document.getElementById('confirm-quit-btn');
        const cancelQuitBtn = document.getElementById('cancel-quit-btn');


        // --- FUNCTIONS ---

        // View Switching
        function showView(viewToShow) {
            setupView.classList.add('hidden');
            inProgressView.classList.add('hidden');
            resultsView.classList.add('hidden');
            reviewView.classList.add('hidden');
            viewToShow.classList.remove('hidden');
            viewToShow.classList.add('fade-in');
        }

        // Assessment Setup
        function renderOptions(target) {
            const details = domainDetails[target];
            let content = '';

            if (target === 'simulated-exam') {
                content = `
                    <div class="assessment-card p-6 sm:p-8 text-center">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${details.title}</h3>
                        <p class="text-gray-600 mb-4">This is a full-length simulated exam with ${details.totalQuestions} questions, weighted according to the official CISM exam outline.</p>
                        <ul class="text-left max-w-sm mx-auto list-disc list-inside mb-6">
                            <li>Domain 1: ${Math.round(details.totalQuestions * domainWeights['domain-1'])} questions</li>
                            <li>Domain 2: ${Math.round(details.totalQuestions * domainWeights['domain-2'])} questions</li>
                            <li>Domain 3: ${Math.round(details.totalQuestions * domainWeights['domain-3'])} questions</li>
                            <li>Domain 4: ${Math.round(details.totalQuestions * domainWeights['domain-4'])} questions</li>
                        </ul>
                        <button class="btn-primary start-assessment-btn" data-type="simulated">Start Simulated Exam</button>
                    </div>
                `;
            } else {
                const weightedQuestions = Math.round(150 * domainWeights[target]);
                content = `
                    <div class="assessment-card p-6 sm:p-8 text-center">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${details.title}</h3>
                        <p class="text-gray-600 mb-6">Choose how you want to test your knowledge for this domain.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="p-6 bg-gray-50 rounded-lg flex flex-col justify-between">
                                <div>
                                    <h4 class="text-xl font-semibold mb-3">Practice Quiz</h4>
                                    <p class="text-sm text-gray-600 mb-4">Take a 10-question practice quiz to test your knowledge.</p>
                                    <p class="text-2xl font-bold text-gray-800 mb-4">10 Questions</p>
                                </div>
                                <button class="btn-primary start-assessment-btn" data-type="custom" data-domain="${target}" data-count="10">Start Practice Quiz</button>
                            </div>
                            <div class="p-6 bg-gray-50 rounded-lg flex flex-col justify-between">
                                <div>
                                    <h4 class="text-xl font-semibold mb-3">Weighted Quiz</h4>
                                    <p class="text-sm text-gray-600 mb-4">Take a quiz weighted like the real exam (${details.weight}% of 150 questions).</p>
                                    <p class="text-2xl font-bold text-gray-800 mb-4">${weightedQuestions} Questions</p>
                                </div>
                                <button class="btn-primary start-assessment-btn" data-type="weighted" data-domain="${target}" data-count="${weightedQuestions}">Start Weighted Quiz</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            optionsArea.innerHTML = content;
        }

        function handleTabClick(e) {
            tabs.forEach(tab => tab.classList.remove('active'));
            e.target.classList.add('active');
            const target = e.target.dataset.target;
            renderOptions(target);
        }

        // Timer Logic
        function stopTimer() {
            if (currentAssessment.timerInterval) {
                clearInterval(currentAssessment.timerInterval);
                currentAssessment.timerInterval = null;
            }
            timerDisplay.classList.add('hidden');
        }

        function startTimer() {
            stopTimer(); // Ensure no previous timer is running
            const duration = 4 * 60 * 60 * 1000; // 4 hours in milliseconds
            const endTime = new Date().getTime() + duration;

            timerDisplay.classList.remove('hidden');

            currentAssessment.timerInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = endTime - now;

                if (distance < 0) {
                    stopTimer();
                    timerDisplay.textContent = "0:00:00";
                    alert("Time's up! The exam will now be submitted.");
                    submitAssessment();
                    return;
                }

                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                timerDisplay.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Assessment Logic
        function startAssessment(questions, type) {
            currentAssessment.questions = questions;
            currentAssessment.userAnswers = new Array(questions.length).fill(null);
            currentAssessment.currentQuestionIndex = 0;
            currentAssessment.startTime = new Date();
            currentAssessment.assessmentType = type;

            if (type === 'simulated') {
                startTimer();
            } else {
                stopTimer();
            }
            
            displayQuestion();
            showView(inProgressView);
        }

        function displayQuestion() {
            const questionData = currentAssessment.questions[currentAssessment.currentQuestionIndex];
            const questionNumber = currentAssessment.currentQuestionIndex + 1;
            const totalQuestions = currentAssessment.questions.length;

            questionCounter.textContent = `Question ${questionNumber} of ${totalQuestions}`;
            progressBar.style.width = `${(questionNumber / totalQuestions) * 100}%`;
            questionText.textContent = questionData.question;
            
            answerOptionsContainer.innerHTML = '';
            questionData.answers.forEach((answer, index) => {
                const option = document.createElement('div');
                option.className = 'answer-option';
                option.textContent = answer;
                option.dataset.index = index;
                if (currentAssessment.userAnswers[currentAssessment.currentQuestionIndex] === index) {
                    option.classList.add('selected');
                }
                option.addEventListener('click', () => selectAnswer(index));
                answerOptionsContainer.appendChild(option);
            });

            prevBtn.classList.toggle('hidden', currentAssessment.currentQuestionIndex === 0);
            nextBtn.classList.toggle('hidden', questionNumber === totalQuestions);
            submitBtn.classList.toggle('hidden', questionNumber !== totalQuestions);
        }

        function selectAnswer(index) {
            currentAssessment.userAnswers[currentAssessment.currentQuestionIndex] = index;
            document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`.answer-option[data-index='${index}']`).classList.add('selected');
        }

        function changeQuestion(direction) {
            currentAssessment.currentQuestionIndex += direction;
            displayQuestion();
        }

        function submitAssessment() {
            stopTimer(); // Stop timer on submission
            let correctCount = 0;
            let breakdown = {};

            currentAssessment.questions.forEach((q, index) => {
                const domain = q.domain || 'domain'; // Fallback domain
                if (!breakdown[domain]) {
                    breakdown[domain] = { correct: 0, total: 0 };
                }
                breakdown[domain].total++;

                if (currentAssessment.userAnswers[index] === q.correct) {
                    correctCount++;
                    breakdown[domain].correct++;
                }
            });

            const totalQuestions = currentAssessment.questions.length;
            const score = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0;

            finalScoreEl.textContent = `${score}%`;
            scoreDetailsEl.textContent = `You answered ${correctCount} out of ${totalQuestions} questions correctly.`;
            
            resultsBreakdownEl.innerHTML = '';
            for (const domainKey in breakdown) {
                const domainData = breakdown[domainKey];
                const domainScore = domainData.total > 0 ? Math.round((domainData.correct / domainData.total) * 100) : 0;
                const title = domainDetails[domainKey]?.title || 'Overall';
                const el = document.createElement('div');
                el.className = 'flex justify-between items-center mb-2';
                el.innerHTML = `
                    <span class="text-gray-700">${title}</span>
                    <span class="font-bold text-gray-800">${domainScore}% (${domainData.correct}/${domainData.total})</span>
                `;
                resultsBreakdownEl.appendChild(el);
            }

            showView(resultsView);
        }
        
        function reviewAnswers() {
            reviewView.innerHTML = ''; // Clear previous review
            const container = document.createElement('div');
            container.className = 'bg-white p-6 sm:p-8 rounded-lg shadow-md';
            
            let reviewContent = `<h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Review Answers</h2>`;
            
            currentAssessment.questions.forEach((q, index) => {
                const userAnswer = currentAssessment.userAnswers[index];
                const isCorrect = userAnswer === q.correct;

                reviewContent += `
                    <div class="mb-8 pb-4 border-b border-gray-200">
                        <p class="font-bold text-gray-800 mb-2">Question ${index + 1}: ${q.question}</p>
                        <div class="space-y-2">
                            ${q.answers.map((answer, ansIndex) => {
                                let classes = 'answer-option p-3';
                                if (ansIndex === q.correct) {
                                    classes += ' correct';
                                } else if (ansIndex === userAnswer && !isCorrect) {
                                    classes += ' incorrect';
                                }
                                return `<div class="${classes}">${answer}</div>`;
                            }).join('')}
                        </div>
                        ${userAnswer !== null && !isCorrect ? `<p class="mt-3 text-sm text-blue-800 bg-blue-100 p-2 rounded-md"><strong>Your Answer:</strong> ${q.answers[userAnswer]}</p>` : ''}
                        <p class="mt-3 text-sm text-green-800 bg-green-100 p-2 rounded-md"><strong>Explanation:</strong> ${q.explanation}</p>
                    </div>
                `;
            });
            
            reviewContent += `<div class="text-center mt-8"><button id="back-to-results-btn" class="btn-primary">Back to Results</button></div>`;
            container.innerHTML = reviewContent;
            reviewView.appendChild(container);

            showView(reviewView);

            document.getElementById('back-to-results-btn').addEventListener('click', () => showView(resultsView));
        }

        function getQuestionsForAssessment(type, domain, count) {
            let questions = [];
            if (type === 'simulated') {
                for (const dKey in domainWeights) {
                    const numQuestions = Math.round(150 * domainWeights[dKey]);
                    const domainQs = [...questionBank[dKey]].map(q => ({...q, domain: dKey})); // Tag with domain
                    // Shuffle and slice for variety
                    const shuffled = domainQs.sort(() => 0.5 - Math.random());
                    questions.push(...shuffled.slice(0, numQuestions));
                }
            } else {
                const numQuestions = count; // Use the count passed from the button's data-count
                const domainQs = [...questionBank[domain]].map(q => ({...q, domain: domain})); // Tag with domain
                // Shuffle and slice
                questions = domainQs.sort(() => 0.5 - Math.random()).slice(0, numQuestions);
            }
            return questions;
        }

        // --- EVENT LISTENERS ---
        tabs.forEach(tab => tab.addEventListener('click', handleTabClick));

        optionsArea.addEventListener('click', (e) => {
            const button = e.target.closest('.start-assessment-btn');
            if (button) {
                const { type, domain, count } = button.dataset;
                const questions = getQuestionsForAssessment(type, domain, parseInt(count));
                if (questions.length > 0) {
                    startAssessment(questions, type);
                } else {
                    alert('Not enough questions in the bank for this selection.');
                }
            }
        });

        nextBtn.addEventListener('click', () => changeQuestion(1));
        prevBtn.addEventListener('click', () => changeQuestion(-1));
        submitBtn.addEventListener('click', submitAssessment);
        
        quitBtn.addEventListener('click', () => {
            quitModal.classList.remove('hidden');
        });

        cancelQuitBtn.addEventListener('click', () => {
            quitModal.classList.add('hidden');
        });

        confirmQuitBtn.addEventListener('click', () => {
            stopTimer();
            quitModal.classList.add('hidden');
            showView(setupView);
        });
        
        reviewAnswersBtn.addEventListener('click', reviewAnswers);
        restartAssessmentBtn.addEventListener('click', () => {
             // Re-run the same assessment
             startAssessment(currentAssessment.questions, currentAssessment.assessmentType);
        });

        // --- INITIALIZATION ---
        renderOptions('domain-1'); // Initialize with the first tab
    });
    </script>
</body>
</html>
