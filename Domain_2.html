<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CISM 2024: Domain 2 - Information Security Risk Management (Interactive Study Guide)</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F5EF; /* Warm Neutral Background */
            color: #333333;
        }
        .container {
            max-width: 1200px;
        }
        .section-header {
            border-left: 4px solid #8FB8A1; /* Soft Green Accent */
            padding-left: 1rem;
        }
        .accordion-button {
            background-color: #EDEAE0; /* Secondary Neutral */
            border-bottom: 1px solid #D5D2C8;
        }
        .accordion-content {
            background-color: #FFFFFF;
            border-bottom: 1px solid #D5D2C8;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px; /* Increased max-width for charts */
            height: 50vh; /* Increased height */
            max-height: 500px; /* Increased max height */
            margin-left: auto;
            margin-right: auto;
            overflow: hidden; /* Prevent overflow */
        }
        @media (min-width: 640px) { /* sm */
            .chart-container {
                height: 45vh; /* Increased height for sm screens */
                max-height: 450px; /* Increased max height for sm screens */
            }
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 40vh; /* Increased height for md screens */
                max-height: 400px; /* Increased max height for md screens */
            }
        }
        .nav-item.active {
            border-bottom: 2px solid #A1C9CE; /* Soft Blue Accent */
            font-weight: 600;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tooltip-custom-title {
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .tooltip-custom-body {
            font-size: 0.8em;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* Risk Matrix Specific Styles */
        .risk-matrix-table {
            width: 100%;
            max-width: 400px; /* Adjust as needed */
            margin: 1rem auto;
            border-collapse: collapse;
        }
        .risk-matrix-table th, .risk-matrix-table td {
            border: 1px solid #D5D2C8;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
        }
        .risk-matrix-table th {
            background-color: #EDEAE0;
            color: #333333;
        }
        .risk-matrix-table td {
            background-color: #FFFFFF;
        }
        .risk-matrix-table .low { background-color: #D4EDDA; color: #155724; } /* Green */
        .risk-matrix-table .medium { background-color: #FFF3CD; color: #856404; } /* Yellow */
        .risk-matrix-table .high { background-color: #F8D7DA; color: #721C24; } /* Red */
        .risk-matrix-table .critical { background-color: #DC3545; color: #FFFFFF; } /* Darker Red */

        /* Vulnerability Mapping Table Styles */
        .vulnerability-mapping-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .vulnerability-mapping-table th, .vulnerability-mapping-table td {
            border: 1px solid #D5D2C8;
            padding: 0.6rem;
            text-align: left;
        }
        .vulnerability-mapping-table th {
            background-color: #EDEAE0;
            font-weight: 600;
            color: #333333;
        }
        .vulnerability-mapping-table td {
            background-color: #FFFFFF;
            color: #555555;
            font-size: 0.9em;
        }

        /* Styles for Risk Framework Cards */
        .risk-framework-card {
            background-color: #EDEAE0; /* Secondary Neutral */
            border: 1px solid #D5D2C8;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            flex: 1 1 calc(50% - 1rem); /* Two cards per row on larger screens */
            max-width: calc(50% - 1rem); /* Max width for two columns */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            text-align: left; /* Align text left within the card */
            font-weight: 600;
            color: #333333;
            min-height: 100px; /* Ensure cards have a minimum height */
            display: flex; /* Use flexbox for content alignment */
            flex-direction: column; /* Stack content vertically */
            justify-content: space-between; /* Push description to bottom if needed */
        }

        .risk-framework-card:hover {
            background-color: #D5D2C8; /* Slightly darker on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .risk-framework-card .card-title {
            font-size: 1.1em;
            margin-bottom: 0.5rem;
            text-align: center; /* Center the title */
        }

        .risk-framework-card .card-description {
            font-weight: 400; /* Regular font weight for description */
            font-size: 0.9em;
            color: #555555;
            margin-top: 0.5rem; /* Space between title and description */
        }

        /* Styles for Risk Response Cards (New) */
        .risk-response-card {
            border: 1px solid #D5D2C8;
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            flex: 1 1 calc(50% - 1rem); /* Two cards per row on larger screens */
            max-width: calc(50% - 1rem);
            box-sizing: border-box;
            text-align: left;
            font-weight: 600;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .risk-response-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Specific colors for risk response cards */
        .risk-response-card.mitigate { background-color: #D4EDDA; color: #155724; } /* Light Green */
        .risk-response-card.mitigate:hover { background-color: #C3E6CB; }
        .risk-response-card.transfer { background-color: #CCE5FF; color: #004085; } /* Light Blue */
        .risk-response-card.transfer:hover { background-color: #B8DAFF; }
        .risk-response-card.avoid { background-color: #F8D7DA; color: #721C24; } /* Light Red */
        .risk-response-card.avoid:hover { background-color: #F5C6CB; }
        .risk-response-card.accept { background-color: #FFF3CD; color: #856404; } /* Light Yellow */
        .risk-response-card.accept:hover { background-color: #FFECB3; }

        .risk-response-card .card-title {
            font-size: 1.1em;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .risk-response-card .card-description {
            font-weight: 400;
            font-size: 0.9em;
            margin-top: 0.5rem;
        }

        /* Risk Posture Scorecard Table Styles */
        .risk-scorecard-table {
            width: 100%;
            max-width: 600px;
            margin: 1rem auto;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .risk-scorecard-table th, .risk-scorecard-table td {
            border: 1px solid #D5D2C8;
            padding: 0.6rem;
            text-align: center;
        }
        .risk-scorecard-table th {
            background-color: #EDEAE0;
            font-weight: 600;
            color: #333333;
        }
        .risk-scorecard-table td {
            background-color: #FFFFFF;
            color: #555555;
        }
        .risk-scorecard-table .risk-level-low { background-color: #D4EDDA; color: #155724; font-weight: 600; }
        .risk-scorecard-table .risk-level-medium { background-color: #FFF3CD; color: #856404; font-weight: 600; }
        .risk-scorecard-table .risk-level-high { background-color: #F8D7DA; color: #721C24; font-weight: 600; }
        .risk-scorecard-table .trend-up::before { content: '▲ '; color: #DC3545; } /* Red up arrow */
        .risk-scorecard-table .trend-down::before { content: '▼ '; color: #28a745; } /* Green down arrow */
        .risk-scorecard-table .trend-stable::before { content: '▬ '; color: #6c757d; } /* Grey dash */

        /* Styles for Corporate Hierarchy Chart */
        .hierarchy-chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem; /* Space between elements */
            padding: 1rem;
            background-color: #F8F5EF; /* Match body background */
            border-radius: 0.5rem;
            max-width: 600px; /* Constrain width for better layout */
            margin: 1rem auto; /* Center the chart */
        }

        .role-node {
            background-color: #EDEAE0; /* Default neutral for nodes */
            color: #333333;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-weight: 600;
            text-align: center;
            min-width: 200px; /* Ensure some minimum width */
            width: fit-content; /* Adjust width to content */
            display: flex; /* Use flexbox for content alignment */
            flex-direction: column; /* Stack content vertically */
            justify-content: space-between; /* Push description to bottom if needed */
        }

        .role-node:hover {
            background-color: #D5D2C8; /* Darker neutral on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .role-node .role-title {
            display: block;
            margin-bottom: 0.5rem; /* Space between title and description */
        }
        .role-node .role-description {
            font-weight: 400; /* Regular font weight for description */
            font-size: 0.9em;
            color: #555555;
            text-align: left; /* Align description text left */
            margin-top: 0.5rem;
        }


        .hierarchy-line {
            width: 2px;
            height: 2rem; /* Length of vertical line */
            background-color: #D5D2C8; /* Neutral line color */
        }

        .hierarchy-line-split {
            width: 60%; /* Horizontal span for split */
            height: 2px;
            background-color: #D5D2C8;
            position: relative;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .hierarchy-line-split::before,
        .hierarchy-line-split::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 1rem; /* Vertical stub from horizontal line */
            background-color: #D5D2C8;
            bottom: 0;
        }
        .hierarchy-line-split::before {
            left: 0;
            transform: translateX(-50%); /* Center under left node */
        }
        .hierarchy-line-split::after {
            right: 0;
            transform: translateX(50%); /* Center under right node */
        }

        /* Specific colors for roles */
        .role-node.board { background-color: #A1C9CE; color: #333333; } /* Soft Blue */
        .role-node.ciso { background-color: #8FB8A1; color: #333333; } /* Soft Green */
        .role-node.data-owners { background-color: #FFD700; color: #333333; } /* Gold */
        .role-node.it-ops { background-color: #FF6384; color: #333333; } /* Pinkish Red */
        .role-node.end-users { background-color: #B0C4DE; color: #333333; } /* Light Steel Blue - Changed for readability */

        /* Adjust for responsiveness of hierarchy chart */
        @media (max-width: 640px) {
            .flex.justify-center.gap-8 {
                flex-direction: column;
                gap: 1rem;
            }
            .role-node {
                max-width: 100%;
                width: 100%;
            }
            .hierarchy-line-split {
                width: 2px; /* Make it vertical on small screens */
                height: 2rem;
                margin: 1rem auto;
            }
            .hierarchy-line-split::before,
            .hierarchy-line-split::after {
                display: none; /* Hide horizontal stubs */
            }
        }
    </style>
</head>
<body class="leading-relaxed">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center py-8 bg-white rounded-lg shadow-md mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-2">CISM Domain 2 Study Guide</h1>
            <p class="text-xl sm:text-2xl text-gray-600">Information Security Risk Management</p>
            <p class="text-md text-gray-500 mt-2">Your Interactive Study Guide for Proactive Security Protection</p>
        </header>

        <nav class="bg-white p-4 rounded-lg shadow-md mb-8 flex justify-center sticky top-0 z-10">
            <button class="nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200 active" data-target="risk-assessment">Information Security Risk Assessment</button>
            <button class="nav-item px-4 py-2 text-lg font-medium text-gray-700 hover:text-gray-900 mx-2 sm:mx-4 transition-colors duration-200" data-target="risk-response">Information Security Risk Response</button>
        </nav>

        <main id="content-area">
            <!-- Information Security Risk Assessment Section -->
            <section id="risk-assessment" class="content-section fade-in">
                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Section A: Information Security Risk Assessment</h2>
                <p class="mb-8 text-gray-700">Information security risk assessment is the systematic process of identifying potential threats and vulnerabilities, analyzing their potential impact, and determining the likelihood of their occurrence. It's about understanding *what could go wrong* and *how bad it could be*.</p>

                <!-- Sub-Domain: Emerging Risk and Threat Landscape -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        1. Emerging Risk and Threat Landscape
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">The threat landscape is constantly evolving. As an information security manager, you must be vigilant and proactive in understanding new and evolving dangers.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Understand emerging and evolving threats (e.g., ransomware, insider threats, third-party risks).</h4>
                        <p class="text-gray-600 mb-4">Explore the common distribution of various emerging threats and how they impact organizations:</p>
                        <div class="chart-container mb-6">
                            <canvas id="threatDistributionChart"></canvas>
                        </div>
                        <div class="flex flex-wrap justify-center gap-4 mb-4">
                            <button class="toggle-chart-data bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-blue-200 transition-colors duration-200" data-chart-id="threatDistributionChart" data-data-set="overall">Overall Distribution</button>
                            <button class="toggle-chart-data bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-green-200 transition-colors duration-200" data-chart-id="threatDistributionChart" data-data-set="ransomwareFocus">Ransomware Focus</button>
                            <button class="toggle-chart-data bg-red-100 text-red-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-red-200 transition-colors duration-200" data-chart-id="threatDistributionChart" data-data-set="insiderFocus">Insider Threat Focus</button>
                        </div>
                        <p class="text-gray-600 text-sm italic">This chart illustrates a simulated distribution of common emerging threats. Use the buttons to view different focuses.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Monitor threat intelligence feeds and industry trend reports.</h4>
                        <p class="text-gray-600 mb-4">Threat intelligence helps organizations understand the "who, what, where, when, why, and how" of attacks, while industry reports provide broad trends for strategic planning.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">c. Analyze external drivers like regulatory shifts, geopolitical risks, and technological disruption.</h4>
                        <p class="text-gray-600">New regulations (e.g., updated data privacy laws), global events, and emerging technologies (e.g., AI, IoT) constantly introduce new security challenges and risks that must be analyzed.</p>
                    </div>
                </div>

                <!-- Sub-Domain: Vulnerability and Control Deficiency Analysis -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        2. Vulnerability and Control Deficiency Analysis
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">Once threats are understood, the next step is to identify where an organization is susceptible to these threats.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Identify and assess weaknesses in IT systems, processes, and controls.</h4>
                        <p class="text-gray-600 mb-4">This involves using various methods like vulnerability scanning, penetration testing, and security audits to pinpoint weaknesses.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Determine exposure levels due to missing or ineffective controls.</h4>
                        <p class="text-gray-600 mb-4">A control might exist but be poorly designed or implemented, leading to increased exposure and higher potential impact.</p>

                        <h4 class="text-lg font-semibold text-gray-700">c. Map vulnerabilities to threats and evaluate potential impacts.</h4>
                        <p class="text-gray-600 mb-4">Understand which threats could exploit identified vulnerabilities and the potential impact on confidentiality, integrity, availability, and overall business operations. See the example mapping below:</p>
                        <div class="mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                            <h6 class="text-md font-semibold text-gray-700 mb-2 text-center">Sample Vulnerability-Threat-Impact Mapping</h6>
                            <table class="vulnerability-mapping-table">
                                <thead>
                                    <tr>
                                        <th>Vulnerability</th>
                                        <th>Threat</th>
                                        <th>Potential Impact</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Unpatched Web Server</td>
                                        <td>Remote Code Execution (RCE) via Exploit</td>
                                        <td>Data breach (Confidentiality), System compromise (Integrity, Availability)</td>
                                    </tr>
                                    <tr>
                                        <td>Weak Employee Password Policy</td>
                                        <td>Brute-force/Credential Stuffing Attack</td>
                                        <td>Unauthorized access to systems/data (Confidentiality, Integrity)</td>
                                    </tr>
                                    <tr>
                                        <td>Lack of Data Encryption at Rest</td>
                                        <td>Physical theft of storage device</td>
                                        <td>Data exposure (Confidentiality)</td>
                                    </tr>
                                    <tr>
                                        <td>Single Point of Failure in Network</td>
                                        <td>Hardware failure, DDoS attack</td>
                                        <td>Service outage, business disruption (Availability)</td>
                                    </tr>
                                    <tr>
                                        <td>Insufficient Security Awareness Training</td>
                                        <td>Phishing, Social Engineering</td>
                                        <td>Credential theft, malware infection, financial fraud (Confidentiality, Integrity, Financial)</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-gray-600 text-sm italic mt-2 text-center">This table illustrates common pairings of vulnerabilities, the threats that exploit them, and the resulting potential impacts.</p>
                        </div>
                    </div>
                </div>

                <!-- Sub-Domain: Risk Assessment and Analysis -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        3. Risk Assessment and Analysis
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">This is where the identified threats, vulnerabilities, and impacts are formally analyzed to quantify or qualify the risk.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Apply qualitative, quantitative, and hybrid risk assessment methods.</h4>
                        <p class="text-gray-600 mb-4">Explore the characteristics of different risk assessment methods:</p>
                        <div class="flex flex-wrap justify-center gap-4 mb-6">
                            <button class="risk-method-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-blue-200 transition-colors duration-200" data-method="qualitative">Qualitative</button>
                            <button class="risk-method-btn bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-green-200 transition-colors duration-200" data-method="quantitative">Quantitative</button>
                            <button class="risk-method-btn bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-semibold hover:bg-purple-200 transition-colors duration-200" data-method="hybrid">Hybrid</button>
                        </div>
                        <div id="risk-method-description" class="p-4 bg-gray-50 rounded-md text-gray-700">
                            <p class="font-bold">Select a method above to learn more.</p>
                            <p>Qualitative: Uses descriptive terms (e.g., high, medium, low) for likelihood and impact. Subjective but quick.</p>
                        </div>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Determine inherent and residual risk.</h4>
                        <p class="text-gray-600 mb-4"><strong>Inherent risk</strong> is the raw risk before controls. <strong>Residual risk</strong> is what remains after controls are applied.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">c. Use standardized risk frameworks (e.g., ISO/IEC 27005, NIST SP 800-30, FAIR, OCTAVE).</h4>
                        <p class="text-gray-600 mb-4">These frameworks provide structure and consistency for risk management processes. Click on a card to learn more:</p>
                        <div class="flex flex-wrap justify-center gap-4 mb-6">
                            <div class="risk-framework-card" data-framework="iso27005">
                                <span class="card-title">ISO/IEC 27005</span>
                                <div class="card-description hidden">Provides guidelines for information security risk management. It supports the general concepts specified in ISO/IEC 27001 (for ISMS) and is designed to assist the satisfactory implementation of information security based on a risk management approach.</div>
                            </div>
                            <div class="risk-framework-card" data-framework="nist80030">
                                <span class="card-title">NIST SP 800-30</span>
                                <div class="card-description hidden">A guide for conducting risk assessments, developed by the National Institute of Standards and Technology (NIST). It provides a systematic approach to identifying, analyzing, and mitigating risks to information systems and organizations.</div>
                            </div>
                            <div class="risk-framework-card" data-framework="fair">
                                <span class="card-title">FAIR</span>
                                <div class="card-description hidden">A quantitative risk analysis model that focuses on understanding and measuring information risk in financial terms. It helps break down complex risk scenarios into measurable components, enabling more objective risk comparisons and cost-benefit analyses.</div>
                            </div>
                            <div class="risk-framework-card" data-framework="octave">
                                <span class="card-title">OCTAVE</span>
                                <div class="card-description hidden">A suite of methods that help organizations assess and manage information security risks. It emphasizes a self-directed approach where organizations identify and prioritize risks based on their own operational risk environment, involving key stakeholders from across the organization.</div>
                            </div>
                        </div>
                        <!-- Removed the separate risk-framework-description div -->

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">d. Evaluate risks based on likelihood and business impact.</h4>
                        <p class="text-gray-600 mb-4">Plotting likelihood against impact helps prioritize risks and align with the organization's risk appetite and tolerance.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">e. Practical Risk Calculations</h4>
                        <p class="text-gray-600 mb-4">Understanding how to quantify risk is crucial for making informed decisions and justifying security investments.</p>

                        <div class="mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                            <h5 class="text-md font-bold text-gray-800 mb-2">Qualitative Risk Example (Risk Register Entry & Matrix)</h5>
                            <p class="text-gray-700 mb-2">Consider a "High" risk of a "Phishing Attack leading to Credential Theft" with a "Medium" likelihood and "High" impact. This would be documented in a risk register and can be visualized on a matrix:</p>
                            <ul class="list-disc list-inside text-gray-600 ml-4 mb-4">
                                <li><strong>Risk ID:</strong> R-001</li>
                                <li><strong>Risk Description:</strong> Phishing attack leading to credential theft.</li>
                                <li><strong>Inherent Risk:</strong> High</li>
                                <li><strong>Likelihood:</strong> Medium</li>
                                <li><strong>Impact:</strong> High (e.g., data breach, financial loss)</li>
                                <li><strong>Risk Owner:</strong> Head of IT Security</li>
                                <li><strong>Proposed Response:</strong> Mitigate (e.g., advanced email filtering, user training)</li>
                                <li><strong>Residual Risk:</strong> Medium (after controls)</li>
                            </ul>

                            <h6 class="text-md font-semibold text-gray-700 mb-2 text-center">Example Risk Matrix (Likelihood vs. Impact)</h6>
                            <table class="risk-matrix-table">
                                <thead>
                                    <tr>
                                        <th>Likelihood \ Impact</th>
                                        <th>Low</th>
                                        <th>Medium</th>
                                        <th>High</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>High</td>
                                        <td class="medium">Medium</td>
                                        <td class="high">High</td>
                                        <td class="critical">Critical</td>
                                    </tr>
                                    <tr>
                                        <td>Medium</td>
                                        <td class="low">Low</td>
                                        <td class="medium">Medium</td>
                                        <td class="high">High</td>
                                    </tr>
                                    <tr>
                                        <td>Low</td>
                                        <td class="low">Low</td>
                                        <td class="low">Low</td>
                                        <td class="medium">Medium</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-gray-600 text-sm italic mt-2 text-center">In this matrix, our example risk (Medium Likelihood, High Impact) falls into the "High" category.</p>
                        </div>

                        <div class="mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                            <h5 class="text-md font-bold text-gray-800 mb-2">Quantitative Risk Calculation (ALE)</h5>
                            <p class="text-gray-700 mb-2">Calculate the Annualized Loss Expectancy (ALE) for a given asset:</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="assetValue" class="block text-gray-700 text-sm font-bold mb-1">Asset Value (AV) ($):</label>
                                    <input type="number" id="assetValue" value="100000" min="0" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200">
                                </div>
                                <div>
                                    <label for="exposureFactor" class="block text-gray-700 text-sm font-bold mb-1">Exposure Factor (EF) (% loss):</label>
                                    <input type="number" id="exposureFactor" value="0.75" min="0" max="1" step="0.01" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200">
                                </div>
                            </div>
                            <p class="text-gray-700 mb-2"><strong>Single Loss Expectancy (SLE):</strong> $AV \times EF$</p>
                            <p class="text-lg font-semibold text-gray-800 mb-4">SLE: $<span id="sleResult"></span></p>

                            <label for="aro" class="block text-gray-700 text-sm font-bold mb-1">Annualized Rate of Occurrence (ARO) (times/year):</label>
                            <input type="number" id="aro" value="0.5" min="0" step="0.1" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200 mb-4">

                            <p class="text-gray-700 mb-2"><strong>Annualized Loss Expectancy (ALE):</strong> $SLE \times ARO$</p>
                            <p class="text-lg font-semibold text-gray-800">ALE: $<span id="aleResult"></span></p>
                            <p class="text-gray-600 text-sm italic mt-2">Adjust the values above to see how SLE and ALE change. ARO of 0.5 means the event is expected to occur once every two years.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Information Security Risk Response Section -->
            <section id="risk-response" class="content-section hidden fade-in">
                <h2 class="text-3xl font-bold section-header text-gray-800 mb-6">Section B: Information Security Risk Response</h2>
                <p class="mb-8 text-gray-700">Once risks have been assessed and analyzed, the next critical phase is to determine how to address them. This involves selecting and implementing appropriate risk treatment strategies.</p>

                <!-- Sub-Domain: Risk Treatment / Risk Response Options -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        1. Risk Treatment / Risk Response Options
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">There are generally four primary strategies for responding to identified risks.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Develop and apply appropriate response strategies:</h4>
                        <p class="text-gray-600 mb-4">Click on a card to learn about each strategy:</p>
                        <div class="flex flex-wrap justify-center gap-4 mb-6">
                            <div class="risk-response-card mitigate" data-response="mitigate">
                                <span class="card-title">Mitigate</span>
                                <div class="card-description hidden">Reduce the likelihood or impact of a risk through the implementation of security controls (e.g., firewalls, encryption, security awareness training). This is the most common response.</div>
                            </div>
                            <div class="risk-response-card transfer" data-response="transfer">
                                <span class="card-title">Transfer</span>
                                <div class="card-description hidden">Shift the financial or operational burden of a risk to a third party (e.g., purchasing cyber insurance, outsourcing to a vendor with strong security clauses).</div>
                            </div>
                            <div class="risk-response-card avoid" data-response="avoid">
                                <span class="card-title">Avoid</span>
                                <div class="card-description hidden">Eliminate the risk entirely by choosing not to engage in or ceasing an activity that gives rise to the risk (e.g., deciding not to store sensitive customer data, discontinuing an insecure legacy application).</div>
                            </div>
                            <div class="risk-response-card accept" data-response="accept">
                                <span class="card-title">Accept</span>
                                <div class="card-description hidden">Acknowledge the existence of a risk and decide to take no further action to mitigate it, usually because the cost of mitigation outweighs the potential impact, or the risk is below the organization's risk tolerance. Requires formal management approval.</div>
                            </div>
                        </div>
                        <!-- Removed the separate risk-response-description div -->

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Ensure treatment aligns with legal, regulatory, and business constraints.</h4>
                        <p class="text-gray-600 mb-4">Risk treatment decisions must comply with all applicable laws and regulations and support overall business objectives.</p>

                        <h4 class="text-lg font-semibold text-gray-700">c. Select controls using frameworks like ISO/IEC 27002 and NIST CSF.</h4>
                        <p class="text-gray-600">These frameworks provide a comprehensive set of generic information security controls and best practices for implementation.</p>
                    </div>
                </div>

                <!-- Sub-Domain: Risk and Control Ownership -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        2. Risk and Control Ownership
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">Clear accountability is essential for effective risk management.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Assign risk ownership to appropriate stakeholders (e.g., data owners, business units).</h4>
                        <p class="text-gray-600 mb-4">Risks belong to the business functions that generate or are most impacted by them, not solely to the security department.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Establish accountability for control implementation and operation.</h4>
                        <p class="text-gray-600 mb-4">Individuals or teams responsible for the implementation and maintenance of specific security controls must be clearly defined.</p>

                        <h4 class="text-lg font-semibold text-gray-700">c. Define responsibilities in risk treatment plans and governance documentation.</h4>
                        <p class="text-gray-600 mb-4">Formal documentation like risk treatment plans and governance policies ensure that risk management is embedded into the organizational culture. Explore typical roles and their ownership responsibilities in the hierarchy below:</p>
                        <div class="mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                            <h6 class="text-md font-semibold text-gray-700 mb-4 text-center">Corporate Hierarchy: Risk and Control Ownership</h6>
                            <div class="hierarchy-chart-container">
                                <div class="role-node board" data-role="board">
                                    <span class="role-title">Board/Executive Management</span>
                                    <div class="role-description hidden"></div>
                                </div>
                                <div class="hierarchy-line"></div>
                                <div class="role-node ciso" data-role="ciso">
                                    <span class="role-title">CISO / Information Security Manager</span>
                                    <div class="role-description hidden"></div>
                                </div>
                                <div class="hierarchy-line-split"></div>
                                <div class="flex justify-center gap-8 w-full">
                                    <div class="role-node data-owners" data-role="dataOwners">
                                        <span class="role-title">Data Owners / Business Unit Heads</span>
                                        <div class="role-description hidden"></div>
                                    </div>
                                    <div class="role-node it-ops" data-role="itOps">
                                        <span class="role-title">IT Operations / Security Teams</span>
                                        <div class="role-description hidden"></div>
                                    </div>
                                </div>
                                <div class="hierarchy-line"></div>
                                <div class="role-node end-users" data-role="endUsers">
                                    <span class="role-title">End Users</span>
                                    <div class="role-description hidden"></div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm italic mt-2 text-center">Click on a role in the hierarchy above to see a detailed description of their responsibilities.</p>
                            <!-- Removed the separate ownership-detail-description div -->
                        </div>
                    </div>
                </div>

                <!-- Sub-Domain: Risk Monitoring and Reporting -->
                <div class="mb-10 p-6 bg-white rounded-lg shadow-md">
                    <button class="accordion-button w-full text-left py-4 px-6 text-xl font-semibold text-gray-800 flex justify-between items-center">
                        3. Risk Monitoring and Reporting
                        <span class="accordion-icon text-2xl">+</span>
                    </button>
                    <div class="accordion-content hidden p-6">
                        <p class="text-gray-700 mb-4">Risk management is not a one-time event; it's a continuous process that requires ongoing monitoring and communication.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">b. Monitor key risk indicators (KRIs), control effectiveness, and residual risk levels.</h4>
                        <p class="text-gray-600 mb-4">Continuously track metrics that provide early warning signals of increasing risk exposure and assess the ongoing effectiveness of security controls.</p>
                        <div class="chart-container mb-6">
                            <canvas id="riskMonitoringKRIChart"></canvas>
                        </div>
                        <div class="mb-4">
                            <label for="riskMonitoringKRISelect" class="block text-gray-700 text-sm font-bold mb-2">Select KRI to view trend:</label>
                            <select id="riskMonitoringKRISelect" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-200">
                                <option value="unpatchedSystems">Unpatched Critical Systems</option>
                                <option value="securityIncidents">Security Incidents Trend</option>
                                <option value="thirdPartyBreaches">Third-Party Breach Incidents</option>
                            </select>
                        </div>
                        <p class="text-gray-600 text-sm italic">This line chart illustrates simulated trends for various Key Risk Indicators (KRIs) related to risk monitoring. Select an KRI from the dropdown to see its trend.</p>

                        <h4 class="text-lg font-semibold text-gray-700 mb-3">a. Maintain and update the risk register.</h4>
                        <p class="text-gray-600 mb-4">The risk register is a living document that tracks all identified risks, their status, and assigned ownership.</p>
                        
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">c. Report risk trends and posture to leadership and boards using dashboards, scorecards, and executive summaries.</h4>
                        <p class="text-gray-600 mb-4">Tailor reports to the audience, providing high-level, strategic overviews for leadership to support informed decision-making. Below is a sample risk posture scorecard:</p>
                        <div class="mb-6 p-4 bg-gray-50 rounded-md shadow-sm">
                            <h6 class="text-md font-semibold text-gray-700 mb-2 text-center">Sample Quarterly Risk Posture Scorecard</h6>
                            <table class="risk-scorecard-table">
                                <thead>
                                    <tr>
                                        <th>Risk Area</th>
                                        <th>Current Level</th>
                                        <th>Trend</th>
                                        <th>Last Review</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Cyber Attack Surface</td>
                                        <td class="risk-level-medium">Medium</td>
                                        <td class="trend-stable">Stable</td>
                                        <td>Q2 2024</td>
                                    </tr>
                                    <tr>
                                        <td>Data Privacy Compliance</td>
                                        <td class="risk-level-low">Low</td>
                                        <td class="trend-down">Improving</td>
                                        <td>Q2 2024</td>
                                    </tr>
                                    <tr>
                                        <td>Third-Party Vendor Risk</td>
                                        <td class="risk-level-high">High</td>
                                        <td class="trend-up">Worsening</td>
                                        <td>Q2 2024</td>
                                    </tr>
                                    <tr>
                                        <td>Insider Threat</td>
                                        <td class="risk-level-medium">Medium</td>
                                        <td class="trend-stable">Stable</td>
                                        <td>Q2 2024</td>
                                    </tr>
                                    <tr>
                                        <td>Operational Resilience</td>
                                        <td class="risk-level-low">Low</td>
                                        <td class="trend-down">Improving</td>
                                        <td>Q2 2024</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-gray-600 text-sm italic mt-2 text-center">This scorecard provides a high-level summary of key risk areas, their current status, and trend, ideal for executive reporting.</p>
                        </div>
                        
                        <h4 class="text-lg font-semibold text-gray-700">d. Support continuous improvement in risk response and awareness.</h4>
                        <p class="text-gray-600">Establish feedback loops and ongoing security awareness programs to continuously enhance the organization's risk posture.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center py-6 mt-8 text-gray-500 text-sm">
            <p>&copy; 2024 CISM Study Guide. All rights reserved. For educational purposes only.</p>
        </footer>
    </div>

    <script>
        // JS Variables for current state and base data
        const currentSection = {
            id: 'risk-assessment'
        };

        // Data for Section A.1.a (Emerging Threats)
        const threatDistributionData = {
            overall: {
                labels: ['Ransomware', 'Insider Threats', 'Third-Party Risks', 'Phishing', 'DDoS', 'APT'],
                data: [25, 15, 20, 20, 10, 10],
                colors: ['#A1C9CE', '#8FB8A1', '#FFD700', '#FF6384', '#6A5ACD', '#DAA520']
            },
            ransomwareFocus: {
                labels: ['Ransomware (High)', 'Insider Threats', 'Third-Party Risks', 'Other'],
                data: [40, 15, 20, 25],
                colors: ['#FF6384', '#8FB8A1', '#FFD700', '#A1C9CE']
            },
            insiderFocus: {
                labels: ['Insider Threats (High)', 'Ransomware', 'Third-Party Risks', 'Other'],
                data: [35, 20, 15, 30],
                colors: ['#8FB8A1', '#A1C9CE', '#FFD700', '#FF6384']
            }
        };

        // Data for Section A.3.a (Risk Assessment Methods)
        const riskMethodDescriptions = {
            qualitative: "<p class='font-bold'>Qualitative Risk Assessment:</p><p>Uses descriptive terms (e.g., high, medium, low) for likelihood and impact. It's subjective but quick and often used for initial assessments or when precise data is unavailable. Good for prioritization.</p>",
            quantitative: "<p class='font-bold'>Quantitative Risk Assessment:</p><p>Assigns numerical values (e.g., monetary cost, probability percentages) to likelihood and impact. Aims for objective, measurable views of risk. Useful for cost-benefit analysis (e.g., SLE, ARO, ALE).</p>",
            hybrid: "<p class='font-bold'>Hybrid Risk Assessment:</p><p>Combines elements of both qualitative and quantitative approaches. Often, qualitative assessments are used to identify and prioritize risks, and then quantitative analysis is applied to the most critical risks for detailed analysis.</p>"
        };

        // Data for Section A.3.c (Risk Frameworks) - Descriptions are now within the HTML for direct display
        const riskFrameworkDescriptions = { /* This object is no longer directly used by JS for rendering, but kept for reference */
            iso27005: {
                name: "ISO/IEC 27005",
                description: "Provides guidelines for information security risk management. It supports the general concepts specified in ISO/IEC 27001 (for ISMS) and is designed to assist the satisfactory implementation of information security based on a risk management approach."
            },
            nist80030: {
                name: "NIST SP 800-30",
                description: "A guide for conducting risk assessments, developed by the National Institute of Standards and Technology (NIST). It provides a systematic approach to identifying, analyzing, and mitigating risks to information systems and organizations."
            },
            fair: {
                name: "FAIR (Factor Analysis of Information Risk)",
                description: "A quantitative risk analysis model that focuses on understanding and measuring information risk in financial terms. It helps break down complex risk scenarios into measurable components, enabling more objective risk comparisons and cost-benefit analyses."
            },
            octave: {
                name: "OCTAVE (Operationally Critical Threat, Asset, and Vulnerability Evaluation)",
                description: "A suite of methods that help organizations assess and manage information security risks. It emphasizes a self-directed approach where organizations identify and prioritize risks based on their own operational risk environment, involving key stakeholders from across the organization."
            }
        };

        // Data for Section B.1.a (Risk Response Options)
        const riskResponseDescriptions = { /* This object is no longer directly used by JS for rendering, but kept for reference */
            mitigate: "Implement controls to lower the likelihood or impact of a risk. This is the most common response, involving security controls like firewalls, encryption, or security awareness training.",
            transfer: "Shift the financial or operational burden of a risk to a third party (e.g., purchasing cyber insurance, outsourcing to a vendor with strong security clauses).",
            avoid: "Eliminate the risk entirely by choosing not to engage in or ceasing an activity that gives rise to the risk (e.g., deciding not to store sensitive customer data, discontinuing an insecure legacy application).",
            accept: "Acknowledge the existence of a risk and decide to take no further action to mitigate it, usually because the cost of mitigation outweighs the potential impact, or the risk is below the organization's risk tolerance. Requires formal management approval."
        };

        // Data for Section B.2.c (Risk and Control Ownership) - Detailed Role Descriptions
        const detailedRoleDescriptions = {
            board: {
                title: "Board/Executive Management Responsibilities",
                description: "The Board and Executive Management hold ultimate accountability for information security risk. Their responsibilities include defining the organization's overall risk appetite, approving major risk management strategies and significant security investments, and providing high-level oversight to ensure that information security aligns with business objectives and regulatory requirements. They ensure adequate resources are allocated for control implementation and monitor the overall effectiveness of the control environment."
            },
            ciso: {
                title: "CISO / Information Security Manager Responsibilities",
                description: "The CISO (Chief Information Security Officer) or Information Security Manager is responsible for the strategic direction and operational oversight of the information security program. This includes advising senior leadership on risk identification and assessment, reporting on the organization's risk posture, facilitating risk treatment decisions, developing and managing the information security program, overseeing control implementation and operation, and reporting on control effectiveness to relevant stakeholders."
            },
            dataOwners: {
                title: "Data Owners / Business Unit Heads Responsibilities",
                description: "Data Owners and Business Unit Heads are accountable for the risks associated with the information assets and business processes within their respective domains. They are responsible for making decisions on how to treat these risks (accept, transfer, or mitigate) and ensuring that appropriate controls are implemented and operated effectively within their business units to protect their data and processes. They often work closely with the CISO to understand their specific risk profiles."
            },
            itOps: {
                title: "IT Operations / Security Teams Responsibilities",
                description: "IT Operations and dedicated Security Teams are primarily responsible for the technical implementation and operational maintenance of security controls. Their duties include identifying technical risks and vulnerabilities, recommending specific mitigation strategies, implementing and maintaining technical controls (such as firewalls, intrusion detection systems, and patching), managing access controls, and responding to security incidents as part of the overall security program."
            },
            endUsers: {
                title: "End User Responsibilities",
                description: "Every end user in the organization plays a vital role in information security. Their responsibilities include understanding and adhering to established security policies and procedures, practicing good security hygiene (e.g., using strong passwords, identifying phishing attempts), and reporting suspicious activities or potential security incidents. While they may not 'own' risks in the same strategic sense as management, their adherence to controls is critical for overall risk reduction."
            }
        };


        // Data for Section B.3.b (Risk Monitoring KRIs)
        const riskMonitoringKRITrendData = {
            unpatchedSystems: {
                label: 'Unpatched Critical Systems (Count)',
                data: [15, 12, 10, 8, 7, 6, 5, 4, 3, 2, 1, 1], // Simulating a decreasing trend
                borderColor: '#FF6384',
                backgroundColor: 'rgba(255, 99, 132, 0.2)'
            },
            securityIncidents: {
                label: 'Security Incidents Reported (Monthly)',
                data: [5, 7, 6, 8, 9, 7, 6, 5, 4, 3, 2, 2], // Simulating fluctuations
                borderColor: '#A1C9CE',
                backgroundColor: 'rgba(161, 201, 206, 0.2)'
            },
            thirdPartyBreaches: {
                label: 'Third-Party Breach Incidents (Quarterly)',
                data: [2, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0], // Simulating infrequent, but impactful events
                borderColor: '#8FB8A1',
                backgroundColor: 'rgba(143, 184, 161, 0.2)'
            }
        };
        const riskMonitoringKRILabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];


        let threatDistributionChartInstance;
        let riskMonitoringKRIChartInstance;

        // Utility function to wrap labels for charts (no longer used for legend directly)
        const wrapLabel = (label, maxCharsPerLine = 16) => {
            if (label.length <= maxCharsPerLine) return label;
            const words = label.split(' ');
            let line = '';
            let lines = [];
            words.forEach(word => {
                if ((line + word).length > maxCharsPerLine) {
                    lines.push(line.trim());
                    line = word + ' ';
                } else {
                    line += word + ' ';
                }
            });
            lines.push(line.trim());
            return lines;
        };

        // Initialize Charts
        const initThreatDistributionChart = () => {
            const ctx = document.getElementById('threatDistributionChart').getContext('2d');
            threatDistributionChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: threatDistributionData.overall.labels,
                    datasets: [{
                        data: threatDistributionData.overall.data,
                        backgroundColor: threatDistributionData.overall.colors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const label = context[0].label;
                                    return Array.isArray(label) ? label.join(' ') : label;
                                },
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed) {
                                        label += context.parsed + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        };

        const initRiskMonitoringKRIChart = () => {
            const ctx = document.getElementById('riskMonitoringKRIChart').getContext('2d');
            riskMonitoringKRIChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: riskMonitoringKRILabels,
                    datasets: [{
                        label: riskMonitoringKRITrendData.unpatchedSystems.label,
                        data: riskMonitoringKRITrendData.unpatchedSystems.data,
                        borderColor: riskMonitoringKRITrendData.unpatchedSystems.borderColor,
                        backgroundColor: riskMonitoringKRITrendData.unpatchedSystems.backgroundColor,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Count'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].label;
                                }
                            }
                        }
                    }
                }
            });
        };

        // Update Chart Functions
        const updateChart = (chartInstance, newData, newLabels, newColors) => {
            if (chartInstance) {
                chartInstance.data.labels = newLabels;
                chartInstance.data.datasets[0].data = newData;
                if (newColors) {
                    chartInstance.data.datasets[0].backgroundColor = newColors;
                }
                chartInstance.update();
            }
        };

        const updateLineChart = (chartInstance, newData, newLabel, newBorderColor, newBackgroundColor) => {
            if (chartInstance) {
                chartInstance.data.datasets[0].label = newLabel;
                chartInstance.data.datasets[0].data = newData;
                chartInstance.data.datasets[0].borderColor = newBorderColor;
                chartInstance.data.datasets[0].backgroundColor = newBackgroundColor;
                chartInstance.data.datasets[0].fill = true;
                chartInstance.update();
            }
        };

        // Quantitative Risk Calculation Function
        const calculateQuantitativeRisk = () => {
            const assetValue = parseFloat(document.getElementById('assetValue').value);
            const exposureFactor = parseFloat(document.getElementById('exposureFactor').value);
            const aro = parseFloat(document.getElementById('aro').value);

            let sle = 0;
            let ale = 0;

            if (!isNaN(assetValue) && !isNaN(exposureFactor)) {
                sle = assetValue * exposureFactor;
            }

            if (!isNaN(sle) && !isNaN(aro)) {
                ale = sle * aro;
            }

            document.getElementById('sleResult').textContent = sle.toFixed(2);
            document.getElementById('aleResult').textContent = ale.toFixed(2);
        };


        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initial Chart Render
            initThreatDistributionChart();
            initRiskMonitoringKRIChart();

            // Initial quantitative risk calculation display
            calculateQuantitativeRisk();

            // Navigation
            document.querySelectorAll('.nav-item').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.add('hidden');
                        section.classList.remove('fade-in');
                    });

                    const targetSection = document.getElementById(button.dataset.target);
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('fade-in');
                    currentSection.id = button.dataset.target;
                });
            });

            // Accordion Functionality
            document.querySelectorAll('.accordion-button').forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('.accordion-icon');

                    if (content.classList.contains('hidden')) {
                        content.classList.remove('hidden');
                        content.classList.add('fade-in');
                        icon.textContent = '–';
                    } else {
                        content.classList.add('hidden');
                        content.classList.remove('fade-in');
                        icon.textContent = '+';
                    }
                });
            });

            // Threat Distribution Chart Toggles
            document.querySelectorAll('.toggle-chart-data[data-chart-id="threatDistributionChart"]').forEach(button => {
                button.addEventListener('click', () => {
                    const dataSetKey = button.dataset.dataSet;
                    const data = threatDistributionData[dataSetKey];
                    updateChart(threatDistributionChartInstance, data.data, data.labels, data.colors);
                });
            });

            // Risk Assessment Method Description Toggles
            const riskMethodDescriptionDiv = document.getElementById('risk-method-description');
            document.querySelectorAll('.risk-method-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const methodType = button.dataset.method;
                    const data = riskMethodDescriptions[methodType];
                    if (data) {
                        riskMethodDescriptionDiv.innerHTML = data;
                    } else {
                        riskMethodDescriptionDiv.innerHTML = `<p class='font-bold'>Method not found.</p>`;
                    }
                });
            });

            // Risk Framework Card Toggles
            document.querySelectorAll('.risk-framework-card').forEach(card => {
                card.addEventListener('click', () => {
                    const descriptionDiv = card.querySelector('.card-description');

                    // Close all other open cards
                    document.querySelectorAll('.risk-framework-card').forEach(otherCard => {
                        const otherDescriptionDiv = otherCard.querySelector('.card-description');
                        if (otherCard !== card && !otherDescriptionDiv.classList.contains('hidden')) {
                            otherDescriptionDiv.classList.add('hidden');
                            otherDescriptionDiv.classList.remove('fade-in');
                        }
                    });

                    // Toggle the clicked card's description
                    if (descriptionDiv) {
                        descriptionDiv.classList.toggle('hidden');
                        descriptionDiv.classList.toggle('fade-in');
                    }
                });
            });


            // Risk Response Option Description Toggles (Updated Logic)
            document.querySelectorAll('.risk-response-card').forEach(card => {
                card.addEventListener('click', () => {
                    const descriptionDiv = card.querySelector('.card-description');

                    // Close all other open cards
                    document.querySelectorAll('.risk-response-card').forEach(otherCard => {
                        const otherDescriptionDiv = otherCard.querySelector('.card-description');
                        if (otherCard !== card && !otherDescriptionDiv.classList.contains('hidden')) {
                            otherDescriptionDiv.classList.add('hidden');
                            otherDescriptionDiv.classList.remove('fade-in');
                        }
                    });

                    // Toggle the clicked card's description
                    if (descriptionDiv) {
                        descriptionDiv.classList.toggle('hidden');
                        descriptionDiv.classList.toggle('fade-in');
                    }
                });
            });

            // Risk and Control Ownership Role Details (New Logic)
            document.querySelectorAll('.role-node').forEach(roleNode => {
                roleNode.addEventListener('click', () => {
                    const roleKey = roleNode.dataset.role;
                    const roleInfo = detailedRoleDescriptions[roleKey];
                    const roleDescriptionDiv = roleNode.querySelector('.role-description');

                    // Close all other open role descriptions
                    document.querySelectorAll('.role-node').forEach(otherRoleNode => {
                        const otherRoleDescriptionDiv = otherRoleNode.querySelector('.role-description');
                        if (otherRoleNode !== roleNode && otherRoleDescriptionDiv && !otherRoleDescriptionDiv.classList.contains('hidden')) {
                            otherRoleDescriptionDiv.classList.add('hidden');
                            otherRoleDescriptionDiv.classList.remove('fade-in');
                        }
                    });

                    // Toggle the clicked role's description
                    if (roleDescriptionDiv && roleInfo) {
                        roleDescriptionDiv.innerHTML = `<p>${roleInfo.description}</p>`; // Set content
                        roleDescriptionDiv.classList.toggle('hidden');
                        roleDescriptionDiv.classList.toggle('fade-in');
                    }
                });
            });


            // Risk Monitoring KRI Chart Selector
            document.getElementById('riskMonitoringKRISelect').addEventListener('change', (event) => {
                const selectedKRI = event.target.value;
                const data = riskMonitoringKRITrendData[selectedKRI];
                updateLineChart(riskMonitoringKRIChartInstance, data.data, data.label, data.borderColor, data.backgroundColor);
            });

            // Quantitative Risk Calculation Event Listeners
            document.getElementById('assetValue').addEventListener('input', calculateQuantitativeRisk);
            document.getElementById('exposureFactor').addEventListener('input', calculateQuantitativeRisk);
            document.getElementById('aro').addEventListener('input', calculateQuantitativeRisk);
        });
    </script>
</body>
</html>

